%YAML 1.1
--- 
StructureVersion: "1.0"
Properties: 
  RUID: 147191839_2091642366
  Name: "CN.Confiscat. Ценники конфискат. Остатки"
  Caption: "CN.Confiscat. Ценники конфискат. Остатки"
  Version: "1.0.0.2"
  Optional: False
  Internal: True
  MD5: 7AEF13DA1A16577F0F0715F5B0FEE80D
Uses: 
  - "147061274_2091642366 CN.Confiscat. Форма остатков.Отчеты"
Objects: 
  - 
    Properties: 
      Class: "TgdcTemplate"
      RUID: 147205758_10987594
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147205721_10987594
    Fields: 
      NAME: "Ценник конфискат. Остатки"
      DESCRIPTION: ~
      TEMPLATETYPE: "FR"
      EDITIONDATE: 2023-08-18T17:18:43+03:00
      TEMPLATEDATA: !!binary > 
        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
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147205722_10987594
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147205721_10987594
    Fields: 
      NAME: "rp_Main147205722_10987594"
      COMMENT: ~
      EVENT: ~
      FUNCTIONTYPE: ~
      GROUPNAME: ~
      INHERITEDRULE: 0
      LANGUAGE: "VBScript"
      LOCALNAME: ~
      MODIFYDATE: ~
      MODULE: "REPORTMAIN"
      MODULECODE: "147061052_2091642366 gdc_frmInvViewRemains147061050_2091642366"
      OBJECTNAME: "gdc_frmInvViewRemains147061050_2091642366"
      OWNERNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      USEDEBUGINFO: 0
      EDITIONDATE: 2023-08-18T17:27:52+03:00
      DISPLAYSCRIPT: | 
        RP_MAIN147205722_10987594
        RP_MAIN147205722_10987594_ABORT
        RP_MAIN147205722_10987594_GRIDSELECTEDKEYS
        
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAT1dORVJGT1JNCQAAAE9XTkVSRk9STQAAAAAAAAAAAAAAAAsAAAAAAAAAAAAA
        AABGTlNUUFJTVAcAAABQT1NUWVBFCwAAANHy8O7o8vwg7+46AAAAAAAAAAAAAAAADgAAAAAAAAAA
        LgAAAF5WIuLx5ewg7+7n6Pbo/+w9MSIsICLi++Hw4O3t++wg7+7n6Pbo/+w9MiIgXlJGTlNURkxQ
        Ug==
      SCRIPT: | 
        Option Explicit
        Function rp_Main147205722_10987594(OwnerForm, PosType)
          BaseQueryList.Clear
        
          Dim gdcObject : Set gdcObject = OwnerForm.gdcObject
          gdcObject.DisableControls
        
          gdcObject.First
          If gdcObject.Eof then
            Call rp_Main147205722_10987594_Abort("Пустой набор данных!", gdcObject)
          End If
        
          dim CustomerSQL
          dim I, docid
        
        
          Select Case PosType
            Case 1
        
            Case 2
              Dim gr : Set gr = OwnerForm.FindComponent("ibgrDetail")
        
              docid = rp_Main147205722_10987594_GridSelectedKeys(gr)
              If docid = "" Then docid = gdcObject.ID
        
              If gdcObject.Eof then
                Call rp_Main147205722_10987594_Abort("Не выбрано ни одной записи!", gdcObject)
              End If
              docid = "(" & docid & ")"
        
              gdcObject.Close
              gdcObject.ExtraConditions.Clear
              gdcObject.ExtraConditions.Add(" M.CARDKEY IN " & docid)
              gdcObject.Open
              gdcObject.First
          End Select
        
          Dim qMem, qSQL, Creator
          set Creator = New TCreator
          set qSQL = Creator.GetObject(null, "TIBSQL", "")
          qSQL.Transaction = gdcBaseManager.ReadTransaction
          qSQL.SQL.Text = _
           "SELECT " & _
           "  con.NAME, " & _
           "  card.USR$PFD_BARCODE as BARCODE, " & _
           "  card.USR$INV_DATERECEIVE as OnDate, " & _
           " av.USR$DOCNUMBER || ' от ' || CAST(av.USR$DOCDATE as VARCHAR(10)) as actnumber, " & _
           "  prov.FULLNAME AS Provider " & _
           "FROM INV_CARD card " & _
           "LEFT JOIN GD_CONTACT con ON con.ID = card.USR$INV_ORIGINCOUNTRYKEY " & _
           "LEFT JOIN GD_COMPANY prov ON prov.CONTACTKEY  =  card.USR$INV_PROVIDER " & _
           "LEFT JOIN USR$CN_ACTVALUATION AV on AV.ID = card.USR$CN_ACTVALUATION " & _
           "JOIN GD_GOOD g ON g.ID = card.GOODKEY " & _
           "WHERE card.ID = :id "
        
          set CustomerSQL = BaseQueryList.Query(BaseQueryList.Add("CustomerSQL", 0))
          CustomerSQL.SQL = _
            "SELECT COMPFULLNAME FROM gd_v_company WHERE id = " + Cstr(IBLogin.Companykey)
          CustomerSQL.Open
        
          Set qMem = BaseQueryList.Query(BaseQueryList.Add("GDCREMAINS", 1))
          Call qMem.AddField("COMPANYNAME", "ftString", 140, False)
          Call qMem.AddField("COUNTRYNAME", "ftString", 140, False)
          call qMem.AddField("GOODNAME", "ftString", 300, False)
          call qMem.AddField("GoodAlias", "ftString", 20, 0)
          call qMem.AddField("BARCODE", "ftString", 20, False)
          call qMem.AddField("VALUENAME", "ftString", 10, False )
          call qMem.AddField("PRICE", "ftCurrency", 0, False )
          call qMem.AddField("REPORTDATE", "ftDate", 0, False )
          call qMem.AddField("DocumentDate", "ftDate", 0, 0)
        
          call qMem.AddField("actnumber", "ftString", 300, 0)
          call qMem.AddField("Weight", "ftBCD", 3, 0)
        
          call qMem.AddField("Provider", "ftString", 100, 0)
          call qMem.AddField("Place", "ftString", 20, 0)
          call qMem.AddField("OnDate", "ftDate", 0, 0)
          call qMem.AddField("OldPrice", "ftFloat", 0, 0)
          call qMem.AddField("Priceone", "ftFloat", 0, 0)
          call qMem.AddField("OldPriceStr", "ftString", 60, 0)
          call qMem.AddField("PriceStr", "ftString", 60, 0)
          call qMem.AddField("PriceoneStr", "ftString", 60, 0)
          call qMem.AddField("IsPrint", "ftInteger", 0, 0)
        
          qMem.Open
          
          dim PrROld,PrCOld,PrR,PrC, PrR1,PrC1
          while not gdcObject.Eof
            qSQL.Close
            qSQL.ParamByName("ID").ASInteger = gdcObject.ID
            qSQL.ExecQuery
        
            qMem.Insert
            qMem.FieldByName("COMPANYNAME").AsString = CustomerSQL.FieldByName("COMPFULLNAME").AsString
            qMem.FieldByName("COUNTRYNAME").AsString = qSQL.FieldByName("NAME").AsString
            qMem.FieldByName("GOODNAME").AsString = gdcObject.FieldByName("NAMEGOOD").AsString
            qMem.FieldByName("BARCODE").AsString = qSQL.FieldByName("BARCODE").AsString
            qMem.FieldByName("VALUENAME").AsString = gdcObject.FieldByName("VALUENAME").AsString
            qMem.FieldByName("PRICE").AsCurrency = gdcObject.FieldByName("USR$INV_COSTRETAILNCU").AsCurrency
            qMem.FieldByName("REPORTDATE").AsDateTime = Date
            qMem.FieldByName("OnDate").AsDateTime = qSQL.FieldByName("OnDate").AsDateTime
            qMem.FieldByName("Provider").AsString = qSQL.FieldByName("Provider").AsString
            qMem.FieldByName("actnumber").AsString = qSQL.FieldByName("actnumber").AsString
            
            PrROld = int(gdcObject.FieldByName("USR$INV_COSTRETAILNCU").AsCurrency)
            PrCOld = Round((gdcObject.FieldByName("USR$INV_COSTRETAILNCU").AsCurrency - PrR) * 100)
            qMem.FieldByName("OldPriceStr").AsString = PrROld & "р." & right("00" & PrCOld, 2) & "к."
        
            PrR = int(gdcObject.FieldByName("USR$INV_COSTRETAILNCU").AsCurrency)
            PrC = Round((gdcObject.FieldByName("USR$INV_COSTRETAILNCU").AsCurrency - PrR) * 100)
            qMem.FieldByName("PriceStr").AsString =  PrR & "р." & right("00" & PrC, 2) & "к."
        
            PrR1 = int(gdcObject.FieldByName("USR$INV_COSTRETAILNCU").AsCurrency)
            PrC1 = Round((gdcObject.FieldByName("USR$INV_COSTRETAILNCU").AsCurrency - PrR1) * 100)
            qMem.FieldByName("PriceoneStr").AsString =  PrR1 & "р." & right("00" & PrC1, 2) & "к."
        
            qMem.FieldByName("IsPrint").AsInteger = 1
            qMem.Post
            gdcObject.Next
          wend
        
          gdcObject.Close
          gdcObject.ExtraConditions.Clear
          gdcObject.Open
        
          gdcObject.EnableControls
          
          Set rp_Main147205722_10987594 = BaseQueryList
        End Function
        
        Sub rp_Main147205722_10987594_Abort(Description, gdcObject)
          gdcObject.EnableControls
          Call Exception.Raise("EAbort", "Не выбрано ни одной записи!")
        End Sub
        
        Function rp_Main147205722_10987594_GridSelectedKeys(ibGr)
          dim SR, keys, i
          set SR = ibGr.SelectedRows
        
          ibGr.DataSource.DataSet.DisableControls
          keys = ""
          if SR.Count > 0 then
            for i = 0 to (SR.Count - 1)
              if SR.IndexOf(SR.Items(i)) > -1 then
                ibGr.DataSource.DataSet.Bookmark = SR.Items(i)
                if keys = "" then
                  keys = ibGr.DataSource.DataSet.FieldByName("ID").AsInteger
                else
                  keys = keys & ", " & ibGr.DataSource.DataSet.FieldByName("ID").AsInteger
                end if
              end if
            next
          end if
          rp_Main147205722_10987594_GridSelectedKeys = keys
          ibGr.DataSource.DataSet.EnableControls
        End Function
        
  - 
    Properties: 
      Class: "TgdcReport"
      RUID: 147205721_10987594
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      NAME: "Ценники"
      DESCRIPTION: ~
      DISPLAYINMENU: 1
      EVENTFORMULAKEY: ~
      FOLDERKEY: ~
      FRQREFRESH: 1
      GLOBALREPORTKEY: ~
      ISLOCALEXECUTE: 1
      ISREBUILD: 1
      MAINFORMULAKEY: "147205722_10987594 rp_Main147205722_10987594"
      MODALPREVIEW: 0
      PARAMFORMULAKEY: ~
      PREVIEW: 1
      REPORTGROUPKEY: "147061058_2091642366 Отчеты(gdc_frmInvViewRemains147061050_2091642366)"
      SERVERKEY: ~
      TEMPLATEKEY: "147205758_10987594 Ценник конфискат. Остатки"
      EDITIONDATE: 2023-08-18T17:27:52+03:00
  - 
    Properties: 
      Class: "TgdcTemplate"
      RUID: 147206065_10987594
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147206002_10987594
    Fields: 
      NAME: "Этикетка 60х40.Остатки"
      DESCRIPTION: ~
      TEMPLATETYPE: "FR"
      EDITIONDATE: 2023-08-18T17:42:05+03:00
      TEMPLATEDATA: !!binary > 
        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
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147206003_10987594
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147206002_10987594
    Fields: 
      NAME: "rp_Main147206003_10987594"
      COMMENT: ~
      EVENT: ~
      FUNCTIONTYPE: ~
      GROUPNAME: ~
      INHERITEDRULE: 0
      LANGUAGE: "VBScript"
      LOCALNAME: ~
      MODIFYDATE: ~
      MODULE: "REPORTMAIN"
      MODULECODE: "147061052_2091642366 gdc_frmInvViewRemains147061050_2091642366"
      OBJECTNAME: "gdc_frmInvViewRemains147061050_2091642366"
      OWNERNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      USEDEBUGINFO: 0
      EDITIONDATE: 2023-08-18T17:44:23+03:00
      DISPLAYSCRIPT: | 
        RP_MAIN147206003_10987594
        RP_MAIN147206003_10987594_ABORT
        RP_MAIN147206003_10987594_GRIDSELECTEDKEYS
        
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAT1dORVJGT1JNCQAAAE9XTkVSRk9STQAAAAAAAAAAAAAAAAsAAAAAAAAAAAAA
        AABGTlNUUFJTVAcAAABQT1NUWVBFCwAAANHy8O7o8vwg7+46AAAAAAAAAAAAAAAADgAAAAAAAAAA
        LgAAAF5WIuLx5ewg7+7n6Pbo/+w9MSIsICLi++Hw4O3t++wg7+7n6Pbo/+w9MiIgXlJGTlNURkxQ
        Ug==
      SCRIPT: | 
        Option Explicit
        Function rp_Main147206003_10987594(OwnerForm, PosType)
          BaseQueryList.Clear
          Dim gdcObject : Set gdcObject = OwnerForm.gdcObject
          gdcObject.DisableControls
        
          gdcObject.First
          If gdcObject.Eof then
            Call rp_Main147206003_10987594_Abort("Пустой набор данных!", gdcObject)
          End If
        
          dim CustomerSQL
          dim I, docid
        
        
          Select Case PosType
            Case 1
        
            Case 2
              Dim gr : Set gr = OwnerForm.FindComponent("ibgrDetail")
        
              docid = rp_Main147206003_10987594_GridSelectedKeys(gr)
              If docid = "" Then docid = gdcObject.ID
        
              If gdcObject.Eof then
                Call rp_Main147206003_10987594_Abort("Не выбрано ни одной записи!", gdcObject)
              End If
              docid = "(" & docid & ")"
        
              gdcObject.Close
              gdcObject.ExtraConditions.Clear
              gdcObject.ExtraConditions.Add(" M.CARDKEY IN " & docid)
              gdcObject.Open
              gdcObject.First
          End Select
        
          Dim qMem, qSQL, Creator
          set Creator = New TCreator
          set qSQL = Creator.GetObject(null, "TIBSQL", "")
          qSQL.Transaction = gdcBaseManager.ReadTransaction
          qSQL.SQL.Text = _
           "SELECT " & _
           "  con.NAME, " & _
           "  card.USR$PFD_BARCODE as BARCODE, " & _
           "  card.USR$INV_DATERECEIVE as OnDate, " & _
           " av.USR$DOCNUMBER || ' от ' || CAST(av.USR$DOCDATE as VARCHAR(10)) as actnumber, " & _
           "  prov.FULLNAME AS Provider " & _
           "FROM INV_CARD card " & _
           "LEFT JOIN GD_CONTACT con ON con.ID = card.USR$INV_ORIGINCOUNTRYKEY " & _
           "LEFT JOIN GD_COMPANY prov ON prov.CONTACTKEY  =  card.USR$INV_PROVIDER " & _
           "LEFT JOIN USR$CN_ACTVALUATION AV on AV.ID = card.USR$CN_ACTVALUATION " & _
           "JOIN GD_GOOD g ON g.ID = card.GOODKEY " & _
           "WHERE card.ID = :id "
        
          set CustomerSQL = BaseQueryList.Query(BaseQueryList.Add("CustomerSQL", 0))
          CustomerSQL.SQL = _
            "SELECT COMPFULLNAME FROM gd_v_company WHERE id = " + Cstr(IBLogin.Companykey)
          CustomerSQL.Open
        
          Set qMem = BaseQueryList.Query(BaseQueryList.Add("GDCREMAINS", 1))
          Call qMem.AddField("COMPANYNAME", "ftString", 140, False)
          Call qMem.AddField("COUNTRYNAME", "ftString", 140, False)
          call qMem.AddField("GOODNAME", "ftString", 300, False)
          call qMem.AddField("GoodAlias", "ftString", 20, 0)
          call qMem.AddField("BARCODE", "ftString", 20, False)
          call qMem.AddField("VALUENAME", "ftString", 10, False )
          call qMem.AddField("PRICE", "ftCurrency", 0, False )
          call qMem.AddField("REPORTDATE", "ftDate", 0, False )
          call qMem.AddField("DocumentDate", "ftDate", 0, 0)
        
          call qMem.AddField("actnumber", "ftString", 300, 0)
          call qMem.AddField("Weight", "ftBCD", 3, 0)
        
          call qMem.AddField("Provider", "ftString", 100, 0)
          call qMem.AddField("Place", "ftString", 20, 0)
          call qMem.AddField("OnDate", "ftDate", 0, 0)
          call qMem.AddField("OldPrice", "ftFloat", 0, 0)
          call qMem.AddField("Priceone", "ftFloat", 0, 0)
          call qMem.AddField("OldPriceStr", "ftString", 60, 0)
          call qMem.AddField("PriceStr", "ftString", 60, 0)
          call qMem.AddField("PriceoneStr", "ftString", 60, 0)
          call qMem.AddField("IsPrint", "ftInteger", 0, 0)
        
          qMem.Open
        
          dim PrROld,PrCOld,PrR,PrC, PrR1,PrC1
          while not gdcObject.Eof
            qSQL.Close
            qSQL.ParamByName("ID").ASInteger = gdcObject.ID
            qSQL.ExecQuery
        
            qMem.Insert
            qMem.FieldByName("COMPANYNAME").AsString = CustomerSQL.FieldByName("COMPFULLNAME").AsString
            qMem.FieldByName("COUNTRYNAME").AsString = qSQL.FieldByName("NAME").AsString
            qMem.FieldByName("GOODNAME").AsString = gdcObject.FieldByName("NAMEGOOD").AsString
            qMem.FieldByName("BARCODE").AsString = qSQL.FieldByName("BARCODE").AsString
            qMem.FieldByName("VALUENAME").AsString = gdcObject.FieldByName("VALUENAME").AsString
            qMem.FieldByName("PRICE").AsCurrency = gdcObject.FieldByName("USR$INV_COSTRETAILNCU").AsCurrency
            qMem.FieldByName("REPORTDATE").AsDateTime = Date
            qMem.FieldByName("OnDate").AsDateTime = qSQL.FieldByName("OnDate").AsDateTime
            qMem.FieldByName("Provider").AsString = qSQL.FieldByName("Provider").AsString
            qMem.FieldByName("actnumber").AsString = qSQL.FieldByName("actnumber").AsString
        
            PrROld = int(gdcObject.FieldByName("USR$INV_COSTRETAILNCU").AsCurrency)
            PrCOld = Round((gdcObject.FieldByName("USR$INV_COSTRETAILNCU").AsCurrency - PrR) * 100)
            qMem.FieldByName("OldPriceStr").AsString = PrROld & "р." & right("00" & PrCOld, 2) & "к."
        
            PrR = int(gdcObject.FieldByName("USR$INV_COSTRETAILNCU").AsCurrency)
            PrC = Round((gdcObject.FieldByName("USR$INV_COSTRETAILNCU").AsCurrency - PrR) * 100)
            qMem.FieldByName("PriceStr").AsString =  PrR & "р." & right("00" & PrC, 2) & "к."
        
            PrR1 = int(gdcObject.FieldByName("USR$INV_COSTRETAILNCU").AsCurrency)
            PrC1 = Round((gdcObject.FieldByName("USR$INV_COSTRETAILNCU").AsCurrency - PrR1) * 100)
            qMem.FieldByName("PriceoneStr").AsString =  PrR1 & "р." & right("00" & PrC1, 2) & "к."
        
            qMem.FieldByName("IsPrint").AsInteger = 1
            qMem.Post
            gdcObject.Next
          wend
        
          gdcObject.Close
          gdcObject.ExtraConditions.Clear
          gdcObject.Open
        
          gdcObject.EnableControls
        
          Set rp_Main147206003_10987594 = BaseQueryList
        End Function
        
        Sub rp_Main147206003_10987594_Abort(Description, gdcObject)
          gdcObject.EnableControls
          Call Exception.Raise("EAbort", "Не выбрано ни одной записи!")
        End Sub
        
        Function rp_Main147206003_10987594_GridSelectedKeys(ibGr)
          dim SR, keys, i
          set SR = ibGr.SelectedRows
        
          ibGr.DataSource.DataSet.DisableControls
          keys = ""
          if SR.Count > 0 then
            for i = 0 to (SR.Count - 1)
              if SR.IndexOf(SR.Items(i)) > -1 then
                ibGr.DataSource.DataSet.Bookmark = SR.Items(i)
                if keys = "" then
                  keys = ibGr.DataSource.DataSet.FieldByName("ID").AsInteger
                else
                  keys = keys & ", " & ibGr.DataSource.DataSet.FieldByName("ID").AsInteger
                end if
              end if
            next
          end if
          rp_Main147206003_10987594_GridSelectedKeys = keys
          ibGr.DataSource.DataSet.EnableControls
        End Function
        
  - 
    Properties: 
      Class: "TgdcReport"
      RUID: 147206002_10987594
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      NAME: "Этикетки"
      DESCRIPTION: ~
      DISPLAYINMENU: 1
      EVENTFORMULAKEY: ~
      FOLDERKEY: ~
      FRQREFRESH: 1
      GLOBALREPORTKEY: ~
      ISLOCALEXECUTE: 1
      ISREBUILD: 1
      MAINFORMULAKEY: "147206003_10987594 rp_Main147206003_10987594"
      MODALPREVIEW: 0
      PARAMFORMULAKEY: ~
      PREVIEW: 1
      REPORTGROUPKEY: "147061058_2091642366 Отчеты(gdc_frmInvViewRemains147061050_2091642366)"
      SERVERKEY: ~
      TEMPLATEKEY: "147206065_10987594 Этикетка 60х40.Остатки"
      EDITIONDATE: 2023-08-18T17:44:23+03:00