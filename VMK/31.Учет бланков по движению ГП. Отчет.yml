%YAML 1.1
--- 
StructureVersion: "1.0"
Properties: 
  RUID: 157598387_1627051006
  Name: "31.Учет бланков по движению ГП. Отчет"
  Caption: "31.Учет бланков по движению ГП. Отчет"
  Version: "1.0.0.2"
  Optional: False
  Internal: True
  MD5: 5832A931F83CA8DA0BCA788C64C33133
Uses: 
  - "147067874_311980179 GS new. Общепит бэк. Исследователь"
  - "147978914_215642201 Торговля - evt_object"
Objects: 
  - 
    Properties: 
      Class: "TgdcTemplate"
      RUID: 157591733_1627051006
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 157591385_1627051006
    Fields: 
      NAME: "31.Учет бланков по движению ГП."
      DESCRIPTION: ~
      TEMPLATETYPE: "FR4"
      EDITIONDATE: 2021-05-07T14:19:28+03:00
      TEMPLATEDATA: | 
        <?xml version="1.0" encoding="utf-8"?>
        <Tgs_fr4SingleReport Version="4.15.13" DotMatrixReport="False" IniFile="\Software\Fast Reports" PreviewOptions.Buttons="4095" PreviewOptions.Zoom="1" PrintOptions.Printer="По умолчанию" PrintOptions.PrintOnSheet="0" ReportOptions.CreateDate="44323,5971733218" ReportOptions.Description.Text="" ReportOptions.LastChange="44323,5971733218" ScriptLanguage="PascalScript" ScriptText.Text="begin&#13;&#10;&#13;&#10;end." PropData="08446174617365747301010C1C00000020446174615365743D22512220446174615365744E616D653D22512200010C2400000020446174615365743D225449544C452220446174615365744E616D653D225449544C45220000095661726961626C65730100055374796C650100">
          <TfrxDataPage Name="Data" Height="1000" Left="0" Top="0" Width="1000"/>
          <TfrxReportPage Name="Page1" PaperWidth="210" PaperHeight="297" PaperSize="9" LeftMargin="10" RightMargin="10" TopMargin="10" BottomMargin="10" ColumnWidth="0" ColumnPositions.Text="" HGuides.Text="" VGuides.Text="">
            <TfrxReportTitle Name="ReportTitle1" Height="83,14966" Left="0" Top="18,89765" Width="718,1107">
              <TfrxMemoView Name="Memo1" Left="0" Top="3,77953" Width="718,1107" Height="60,47248" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-16" Font.Name="Arial" Font.Style="1" HAlign="haCenter" ParentFont="False" Text="РЈС‡РµС‚ Р‘РЎРћ РїСЂРё РґРІРёР¶РµРЅРёРё Р“Рџ Р·Р° РїРµСЂРёРѕРґ &#13;&#10;СЃ [DATESTR(&#60;TITLE.&#34;Db&#34;&#62;)] РїРѕ [DATESTR(&#60;TITLE.&#34;De&#34;&#62;)]&#13;&#10;РїРѕ РїРѕРґСЂР°Р·РґРµР»РµРЅРёСЋ [TITLE.&#34;Dept&#34;]"/>
            </TfrxReportTitle>
            <TfrxHeader Name="Header1" Height="22,67718" Left="0" Top="162,51979" Width="718,1107">
              <TfrxMemoView Name="Memo2" Left="0" Top="0" Width="37,7953" Height="22,67718" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="в„– Рї.Рї."/>
              <TfrxMemoView Name="Memo3" Left="37,7953" Top="0" Width="75,5906" Height="22,67718" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="Р”Р°С‚Р° "/>
              <TfrxMemoView Name="Memo4" Left="113,3859" Top="0" Width="75,5906" Height="22,67718" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РќРѕРјРµСЂ"/>
              <TfrxMemoView Name="Memo5" Left="188,9765" Top="0" Width="340,1577" Height="22,67718" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РљРѕРЅС‚СЂР°РіРµРЅС‚"/>
              <TfrxMemoView Name="Memo6" Left="680,3154" Top="0" Width="37,7953" Height="22,67718" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РўРёРї"/>
              <TfrxMemoView Name="Memo12" Left="529,1342" Top="0" Width="151,1812" Height="22,67718" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РџРѕРґСЂР°Р·РґРµР»РµРЅРёРµ"/>
            </TfrxHeader>
            <TfrxMasterData Name="MasterData1" Height="18,89765" Left="0" Top="207,87415" Width="718,1107" ColumnWidth="0" ColumnGap="0" DataSet="Q" DataSetName="Q" RowCount="0">
              <TfrxMemoView Name="Memo7" Left="0" Top="0" Width="37,7953" Height="18,89765" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="[Line#]"/>
              <TfrxMemoView Name="Memo8" Left="37,7953" Top="0" Width="75,5906" Height="18,89765" ShowHint="False" DataField="DOCUMENTDATE" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;DOCUMENTDATE&#34;]"/>
              <TfrxMemoView Name="Memo9" Left="113,3859" Top="0" Width="75,5906" Height="18,89765" ShowHint="False" DataField="NUMBER" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;NUMBER&#34;]"/>
              <TfrxMemoView Name="Memo10" Left="188,9765" Top="0" Width="340,1577" Height="18,89765" ShowHint="False" DataField="NAME" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="15" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;NAME&#34;]"/>
              <TfrxMemoView Name="Memo11" Left="680,3154" Top="0" Width="37,7953" Height="18,89765" ShowHint="False" DataField="DT" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;DT&#34;]"/>
              <TfrxMemoView Name="Memo13" Left="529,1342" Top="0" Width="151,1812" Height="18,89765" ShowHint="False" DataField="DEPNAME" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="15" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;DEPNAME&#34;]"/>
            </TfrxMasterData>
          </TfrxReportPage>
        </Tgs_fr4SingleReport>
        
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 157591386_1627051006
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 157591385_1627051006
    Fields: 
      NAME: "rp_Main157591386_1627051006"
      COMMENT: ~
      EVENT: ~
      FUNCTIONTYPE: ~
      GROUPNAME: ~
      INHERITEDRULE: 0
      LANGUAGE: "VBScript"
      LOCALNAME: ~
      MODIFYDATE: ~
      MODULE: "REPORTMAIN"
      MODULECODE: "1010001_17 APPLICATION"
      OBJECTNAME: "APPLICATION"
      OWNERNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      USEDEBUGINFO: 0
      EDITIONDATE: 2021-05-07T15:06:52+03:00
      DISPLAYSCRIPT: | 
        RP_MAIN157591386_1627051006
        
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAUEVSSU9EBgAAAM/l8Oju5AAAAAAAAAAAAAAAAAwAAAAAAAAAAAIAAABeUkZO
        U1RQUlNUAwAAAERFUA0AAADP7uTw4Ofk5evl7ejlDgAAAGdkX2NvbnRhY3QgZ2cxBAAAAG5hbWUC
        AAAAaWQHpwAAACJnZzEuY29udGFjdHR5cGUgPSA0IGFuZCBFWElTVFMgKFNFTEVDVCBjb24uaWQg
        RlJPTSBnZF9jb250YWN0IGNvbiB3aGVyZSBjb24ubGIgPCBnZzEubGIgYW5kIGNvbi5yYiA+Z2cx
        LnJiIGFuZCBjb24uaWQgPTxSVUlEIHhpZD0iIjE0NzY3MzYwOCIiIGRiaWQ9IiIxNTg1MDk4ODIw
        IiIvPikiCAAAAFZCU2NyaXB0AAAAAEZOU1RQUlNUBQAAAEJUWVBFCgAAANLo7yDh6+Dt6uAAAAAA
        AAAAAAAAAAANAAAAAAAAAAAUAAAAXlYi0s090s0iLCAi0tLNPdLSzSJGTlNURkxQUg==
      SCRIPT: | 
        Option Explicit
        Function rp_Main157591386_1627051006(period, dep, btype)
          BaseQueryList.Clear
        
          Dim q
          Set q = BaseQueryList.Query(BaseQueryList.Add("q", 0))
          q.SQL = " SELECT " & _
            " doc.id, " & _
            " doc.number, " & _
            " doc.documentdate, " & _
            " con.name, " & _
            " dep.name as DepName, " & _
            " IIF(con.id in (SELECT " & _
            "                  MD.ID " & _
            "                FROM GD_CONTACT MD " & _
            "                LEFT JOIN GD_CONTACT MD1 on MD1.LB<=MD.LB and MD1.rb>=MD.RB " & _
            "                WHERE MD1.ID = 147059146 and MD.CONTACTTYPE=4 " & _
            "                GROUP BY 1  ),'ТН','ТТН') as DT " & _
            " FROM gd_document doc " & _
            " LEFT JOIN usr$mn_move m ON m.documentkey = doc.id " & _
            " LEFT JOIN USR$INV_SELLBILL sb on sb.DOCUMENTKEY = doc.ID " & _
            " LEFT JOIN gd_contact con ON con.id = (IIF(doc.DOCUMENTTYPEKEY = <RUID xID=""147153868"" dbID=""250734751""/>,m.USR$todepot,sb.USR$CONTACTKEY)) " & _
            " left join gd_contact dep on dep.id = (IIF(doc.DOCUMENTTYPEKEY = <RUID xID=""147153868"" dbID=""250734751""/>,m.usr$fromdepot,sb.USR$MAINDEPOTKEY)) " & _
            " " & _
            " WHERE doc.documentdate between :datebegin and :dateend " & _
            " and doc.DOCUMENTTYPEKEY in(<RUID xID=""147153868"" dbID=""250734751""/>, <RUID xID=""154715503"" dbID=""324253476""/>) " & _
            " and doc.PARENT is null "
            IF dep(0)>0 Then
              q.SQL = q.SQL + " AND DEP.ID = " & dep(0)
            END IF
            
            IF btype<>"" Then
              q.SQL = q.SQL + " AND IIF(con.id in (SELECT " & _
                "      MD.ID " & _
                "      FROM GD_CONTACT MD " & _
                "      LEFT JOIN GD_CONTACT MD1 on MD1.LB<=MD.LB and MD1.rb>=MD.RB " & _
                "      WHERE MD1.ID = 147059146 and MD.CONTACTTYPE=4 " & _
                "      GROUP BY 1  ),'ТН','ТТН') = '" & btype & "'"
            END IF
            q.SQL = q.SQL + _
            " GROUP BY  doc.id, doc.number, doc.documentdate, con.name, dep.name, con.ID " & _
            " ORDER BY doc.number, doc.documentdate, con.name "
          q.ParamByName("datebegin").asDateTime= period(0)
          q.ParamByName("dateend").asDateTime= period(1)
          q.Open
          
          dim title , Deptname
        
          if dep(0)>0 Then
            Deptname  = q.FieldByNAme("DEPNAME").asString
          ELSE
            Deptname = "ККЦ"
          END IF
        
          set title = BaseQueryList.Query(BaseQueryList.Add("title", 1))
          call title.AddField("Db", "ftDateTime", 0, 0)
          call title.AddField("De", "ftDateTime", 0, 0)
          call title.AddField("Dept", "ftString", 60, 0)
          title.Open
          title.Edit
          title.FieldBYNAme("db").AsDateTime = period(0)
          title.FieldBYNAme("de").AsDateTime = period(1)
          title.FieldBYNAme("Dept").AsString = Deptname
          title.Post
        
          Set rp_Main157591386_1627051006 = BaseQueryList
        End Function
        
  - 
    Properties: 
      Class: "TgdcReport"
      RUID: 157591385_1627051006
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      NAME: "31.Учет бланков по движению ГП"
      DESCRIPTION: ~
      DISPLAYINMENU: 1
      EVENTFORMULAKEY: ~
      FOLDERKEY: "147128142_340627674 Исследователь\\Общепит\\07. Отчёты общепит"
      FRQREFRESH: 1
      GLOBALREPORTKEY: ~
      ISLOCALEXECUTE: 1
      ISREBUILD: 1
      MAINFORMULAKEY: "157591386_1627051006 rp_Main157591386_1627051006"
      MODALPREVIEW: 0
      PARAMFORMULAKEY: ~
      PREVIEW: 1
      REPORTGROUPKEY: "147094279_157767347 Отчеты по общепиту"
      SERVERKEY: ~
      TEMPLATEKEY: "157591733_1627051006 31.Учет бланков по движению ГП."
      EDITIONDATE: 2021-05-07T15:06:52+03:00