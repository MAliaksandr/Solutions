%YAML 1.1
--- 
StructureVersion: "1.0"
Properties: 
  RUID: 167681725_2005950926
  Name: "Заказ-наряд с Нетто/брутто"
  Caption: "Заказ-наряд с Нетто/брутто"
  Version: "1.0.0.1"
  Optional: False
  Internal: True
  MD5: 079D13C023D6F703C877F583C330ACE6
Uses: 
  - "147057957_311980179 GS.Общепит.back - Документы. Заказ-наряд"
Objects: 
  - 
    Properties: 
      Class: "TgdcTemplate"
      RUID: 167681685_2005950926
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 167681675_2005950926
    Fields: 
      NAME: "Заказ-наряд152640711_674245904147066990_167681685_2005950926"
      DESCRIPTION: ~
      TEMPLATETYPE: "FR"
      EDITIONDATE: 2023-01-16T12:28:35+03:00
      TEMPLATEDATA: !!binary > 
        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
        /7GaotDx5UA=
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 167681676_2005950926
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 167681675_2005950926
    Fields: 
      NAME: "rp_Main147063760_157767346149809634_3953167681676_2005950926"
      COMMENT: ~
      EVENT: ~
      FUNCTIONTYPE: ~
      GROUPNAME: ~
      INHERITEDRULE: 0
      LANGUAGE: "VBScript"
      LOCALNAME: ~
      MODIFYDATE: ~
      MODULE: "REPORTMAIN"
      MODULECODE: "147103191_546801707 gdc_frmUserComplexDocument147103186_546801707"
      OBJECTNAME: "gdc_frmUserComplexDocument147103186_546801707"
      OWNERNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      USEDEBUGINFO: 0
      EDITIONDATE: 2023-01-16T12:28:39+03:00
      DISPLAYSCRIPT: | 
        RP_MAIN147063760_157767346149809634_3953167681676_2005950926
        
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAT1dORVJGT1JNCQAAAE9XTkVSRk9STQAAAAAAAAAAAAAAAAsAAAAAAAAAAAAA
        AABGTlNUUFJTVAgAAABESVJFQ1RPUggAAADE6PDl6vLu8AoAAABHRF9DT05UQUNUBAAAAE5BTUUC
        AAAASUQHDwAAAGNvbnRhY3R0eXBlID0gMgAAAAAAAAAARk5TVFBSU1QDAAAAWkFWEgAAAMfg4i4g
        7/Du6Ofi7uTx8uLu7AoAAABHRF9DT05UQUNUBAAAAE5BTUUCAAAASUQHDwAAAGNvbnRhY3R0eXBl
        ID0gMgAAAAAAAAAARk5TVFBSU1QDAAAAQlVICQAAAMHz9ePg6/Ll8AoAAABHRF9DT05UQUNUBAAA
        AE5BTUUCAAAASUQHDwAAAGNvbnRhY3R0eXBlID0gMgAAAAAAAAAARk5TVEZMUFI=
      SCRIPT: | 
        function rp_Main147063760_157767346149809634_3953167681676_2005950926(OwnerForm, Director, Zav, Buh)
          dim doc, id, q, q1, q2, q3
          doc = OwnerForm.SelectedKey
          id = "(" + Join(doc(0), ",") + ")"
        
          BaseQueryList.Clear
        
        
          set Contact1 = BaseQueryList.Query(BaseQueryList.Add("Responsible1", 0))
          Contact1.SQL = "SELECT con.name , p.rank FROM gd_contact con JOIN gd_people p on p.contactkey = con.id WHERE con.id = :id"
          Contact1.ParamByName("id").AsInteger = Director(0)
          Contact1.Open
          set Contact2 = BaseQueryList.Query(BaseQueryList.Add("Responsible2", 0))
          Contact2.SQL = "SELECT con.name , p.rank FROM gd_contact con JOIN gd_people p on p.contactkey = con.id WHERE con.id = :id"
          Contact2.ParamByName("id").AsInteger = Zav(0)
          Contact2.Open
          set Contact3 = BaseQueryList.Query(BaseQueryList.Add("Responsible3", 0))
          Contact3.SQL = "SELECT con.name , p.rank FROM gd_contact con JOIN gd_people p on p.contactkey = con.id WHERE con.id = :id"
          Contact3.ParamByName("id").AsInteger = Buh(0)
          Contact3.Open
        
          ' Шапка
          set q = BaseQueryList.Query(BaseQueryList.Add("MAIN", 0))
          q.SQL = _
            " SELECT doc.number, doc.documentdate, con.name FROM usr$mn_pilot p " + _
            " JOIN GD_DOCUMENT doc on doc.id = p.documentkey and doc.id in " + ID +  _
            " LEFT JOIN gd_contact con on con.id = p.usr$depotkey "
          q.Open
        
          ' список блюд
          set q1 = BaseQueryList.Query(BaseQueryList.Add("LIST", 0))
          q1.SQl = _
            " SELECT g.name, g.alias, SUM(p.usr$quantity) usr$quantity, " + _
            " p.usr$receiptkey,r.USR$OUTPUT " +_
            " FROM usr$mn_pilotline p " + _
            " JOIN usr$mn_receipt r on r.documentkey = p.usr$receiptkey and p.masterkey in " + ID +  _
            " JOIN gd_good g on g.id = r.usr$goodkey " &_
            " GROUP BY 1,2,4, 5 "  &_
            " ORDER BY 1 "
          q1.Open
        
          ' Перечень товаров
          set q2 = BaseQueryList.Query(BaseQueryList.Add("Goods", 0))
          q2.SQl = _
           " SELECT distinct g.Name, g.alias, g.usr$mn_measure, g.id  " & _
           " FROM  " & _
           " usr$mn_pilotline pl  " & _
           " LEFT JOIN USR$MN_GET_RECEIPT_COMPONENTS(pl.usr$receiptkey) rc on 1=1 and rc.subheader = 0 " & _
           " LEFT JOIN gd_good g on g.id = rc.goodkey  " & _
           " WHERE pl.masterkey in " & id &  _
           " group by g.id, g.usr$mn_measure, g.name, g.alias " & _
           " ORDER BY g.Name  "
        
          q2.Open
          q2.IsResult = 1
        
          set q3 = BaseQueryList.Query(BaseQueryList.Add("Company", 0))
          q3.SQL = _
            "SELECT * FROM gd_v_company where id = :CompanyKey "
          q3.ParamByName("CompanyKey").AsInteger = IBLogin.CompanyKey
          q3.Open
        
          set Creator = new TCreator
          set q4 = Creator.GetObject(NULL, "TIBSQL", "")
          q4.Transaction = gdcBaseManager.ReadTransaction
          q4.SQl.Text = _
            " SELECT G.ID, " + _
            " iif( (not g.usr$mn_measure is null and g.usr$mn_measure <> 0), SUM(rc.grossweight * pl.usr$quantity)/g.usr$mn_measure , SUM(rc.grossweight * pl.usr$quantity)) as qty, " +_
            "  iif( (not g.usr$mn_measure is null and g.usr$mn_measure <> 0), SUM(rc.NETWEIGHT * pl.usr$quantity)/g.usr$mn_measure , SUM(rc.NETWEIGHT * pl.usr$quantity)) as netqty " & _
            " FROM " + _
            " usr$mn_pilotline pl " + _
            " LEFT JOIN usr$mn_get_receipt_components(pl.usr$receiptkey) rc on 1=1 and rc.SUBHEADER = 0" + _
            " LEFT JOIN gd_good g on g.id = rc.goodkey " + _
            " WHERE pl.masterkey in  " + ID + _
            " AND G.ID = :GID " &_
            " and pl.USR$RECEIPTKEY = :rkey "&_
            " group by g.id, g.usr$mn_measure "
        
        
          Dim cross, q4
          set cross = BaseQueryList.Query(BaseQueryList.Add("cross", 1))
          call cross.AddField("goodkey", "ftInteger", 0, 0)
          call cross.AddField("name", "ftString", 60, 0)
          call cross.AddField("alias", "ftString", 10, 0)
          call cross.AddField("rname", "ftString", 60, 0)
          call cross.AddField("ralias", "ftString", 10, 0)
          call cross.AddField("Measure", "ftCurrency", 0, 0)
          call cross.AddField("Receiptkey", "ftInteger", 0, 0)
          call cross.AddField("qty", "ftCurrency", 0, 0)
          call cross.AddField("netqty", "ftCurrency", 0, 0)
          call cross.AddField("rqty", "ftCurrency", 0, 0)
          call cross.AddField("output", "ftString", 20, 0)
          cross.Open
        
          while not q1.Eof
            q2.First
            while not q2.Eof
              cross.Append
              cross.FieldByName("Receiptkey").AsInteger = q1.FieldByName("usr$receiptkey").AsInteger
              cross.FieldByName("Goodkey").AsInteger = q2.FieldByName("id").AsInteger
              cross.FieldByName("Name").AsVariant = q2.FieldByName("Name").AsVariant
              cross.FieldByName("Alias").AsVariant = q2.FieldByName("Alias").AsVariant
              cross.FieldByName("RName").AsVariant = q1.FieldByName("Name").AsVariant
              cross.FieldByName("RAlias").AsVariant = q1.FieldByName("Alias").AsVariant
              cross.FieldByName("rqty").ASCurrency = q1.FieldByName("usr$quantity").ASCurrency
              cross.FieldByName("Measure").AsVariant = q2.FieldByName("usr$mn_measure").AsVariant
              cross.FieldByName("output").AsVariant =q1.FieldByName("USR$OUTPUT").AsVariant
              q4.Close
              q4.ParamByName("gid").AsInteger = q2.FieldByName("id").AsInteger
              q4.ParamByName("rkey").AsInteger = q1.FieldByName("usr$receiptkey").AsInteger
              q4.ExecQuery
        
              if not q4.EOF then
                cross.FieldByName("netqty").ASCurrency = q4.FieldByName("netqty").ASCurrency
                cross.FieldByName("qty").ASCurrency = q4.FieldByName("qty").ASCurrency
              else
                cross.FieldByName("netqty").ASCurrency = 0
                cross.FieldByName("qty").ASCurrency = 0
              end if
              cross.Post
              q2.Next
            wend
            q1.Next
          wend
        
          BaseQueryList.AddMasterDetail "Goods", "id", "cross", "goodkey;rName"
        
          set rp_Main147063760_157767346149809634_3953167681676_2005950926 = BaseQueryList
        end function
        
  - 
    Properties: 
      Class: "TgdcReport"
      RUID: 167681675_2005950926
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      NAME: "Заказ-наряд ММПЗ нетто/брутто"
      DESCRIPTION: ~
      DISPLAYINMENU: 1
      EVENTFORMULAKEY: ~
      FOLDERKEY: ~
      FRQREFRESH: 1
      GLOBALREPORTKEY: ~
      ISLOCALEXECUTE: 1
      ISREBUILD: 1
      MAINFORMULAKEY: "167681676_2005950926 rp_Main147063760_157767346149809634_3953167681676_2005950926"
      MODALPREVIEW: 0
      PARAMFORMULAKEY: ~
      PREVIEW: 1
      REPORTGROUPKEY: "147069385_1892754951 Отчеты(gdc_frmUserComplexDocument147103186_546801707)\\Заказ-наряд"
      SERVERKEY: ~
      TEMPLATEKEY: "167681685_2005950926 Заказ-наряд152640711_674245904147066990_167681685_2005950926"
      EDITIONDATE: 2023-01-16T12:28:39+03:00