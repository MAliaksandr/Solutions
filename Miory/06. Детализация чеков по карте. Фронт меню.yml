%YAML 1.1
--- 
StructureVersion: "1.0"
Properties: 
  RUID: 149274581_2010018534
  Name: "06. Детализация чеков по карте. Фронт меню"
  Caption: "06. Детализация чеков по карте. Фронт меню"
  Version: "1.0.0.1"
  Optional: False
  Internal: True
  MD5: 07CB6B8DECAAA52D3C423C23555A7A17
Uses: 
  - "147023114_301427377 GS.PositiveCheck. Исследователь"
  - "147019071_301427377 GS.PositiveCheck. Отчёты"
Objects: 
  - 
    Properties: 
      Class: "TgdcTemplate"
      RUID: 149274053_2010018534
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 149273880_2010018534
    Fields: 
      NAME: "06. Детализация чеков по карте"
      DESCRIPTION: ~
      TEMPLATETYPE: "FR4"
      EDITIONDATE: 2023-06-09T13:45:46+03:00
      TEMPLATEDATA: | 
        <?xml version="1.0" encoding="utf-8"?>
        <Tgs_fr4SingleReport Version="4.15.13" DotMatrixReport="False" IniFile="\Software\Fast Reports" PreviewOptions.Buttons="4095" PreviewOptions.Zoom="1" PrintOptions.Printer="По умолчанию" PrintOptions.PrintOnSheet="0" ReportOptions.CreateDate="45086,5387758449" ReportOptions.Description.Text="" ReportOptions.LastChange="45086,5387758449" ScriptLanguage="PascalScript" ScriptText.Text="begin&#13;&#10;&#13;&#10;end." PropData="08446174617365747301010C1C00000020446174615365743D22512220446174615365744E616D653D22512200010C2400000020446174615365743D225449544C452220446174615365744E616D653D225449544C45220000095661726961626C65730100055374796C650100">
          <TfrxDataPage Name="Data" Height="1000" Left="0" Top="0" Width="1000"/>
          <TfrxReportPage Name="Page1" PaperWidth="210" PaperHeight="297" PaperSize="9" LeftMargin="10" RightMargin="10" TopMargin="10" BottomMargin="10" ColumnWidth="0" ColumnPositions.Text="" HGuides.Text="" VGuides.Text="">
            <TfrxReportTitle Name="ReportTitle1" Height="68,03154" Left="0" Top="18,89765" Width="718,1107">
              <TfrxMemoView Name="Memo1" Left="0" Top="3,77953" Width="718,1107" Height="41,57483" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" HAlign="haCenter" ParentFont="False" Text="Р”РµС‚Р°Р»РёР·Р°С†РёСЏ Р·Р° РїРµСЂРёРѕРґ СЃ [TITLE.&#34;DAYBEGIN&#34;] РїРѕ [TITLE.&#34;DAYEND&#34;]"/>
              <TfrxMemoView Name="Memo14" Left="15,11812" Top="49,13389" Width="370,39394" Height="15,11812" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="1" ParentFont="False" Text="РўР°Р±РµР»СЊРЅС‹Р№ РЅРѕРјРµСЂ: [Q.&#34;TABNUM&#34;],   [Q.&#34;NAME&#34;]"/>
            </TfrxReportTitle>
            <TfrxHeader Name="Header1" Height="30,23624" Left="0" Top="147,40167" Width="718,1107">
              <TfrxMemoView Name="Memo2" Left="79,37013" Top="0" Width="71,81107" Height="30,23624" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РќРѕРјРµСЂ С‡РµРєР°"/>
              <TfrxMemoView Name="Memo3" Left="151,1812" Top="0" Width="154,96073" Height="30,23624" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РўРёРї РѕРїР»Р°С‚С‹"/>
              <TfrxMemoView Name="Memo4" Left="306,14193" Top="0" Width="113,3859" Height="30,23624" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РЎСѓРјРјР° РѕРїР»Р°С‚С‹"/>
              <TfrxMemoView Name="Memo5" Left="419,52783" Top="0" Width="98,26778" Height="30,23624" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РЎСѓРјРјР° Р·Р°РєР°Р·Р°"/>
              <TfrxMemoView Name="Memo6" Left="517,79561" Top="0" Width="94,48825" Height="30,23624" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РЎСѓРјРјР° СЃРєРёРґРєРё"/>
              <TfrxMemoView Name="Memo7" Left="612,28386" Top="0" Width="94,48825" Height="30,23624" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РЎСѓРјРјР° СЃРѕ СЃРєРёРґРєРѕР№"/>
              <TfrxMemoView Name="Memo15" Left="7,55906" Top="0" Width="71,81107" Height="30,23624" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="Р”Р°С‚Р° С‡РµРєР°"/>
            </TfrxHeader>
            <TfrxMasterData Name="MasterData1" Height="18,89765" Left="0" Top="200,31509" Width="718,1107" ColumnWidth="0" ColumnGap="0" DataSet="Q" DataSetName="Q" RowCount="0">
              <TfrxMemoView Name="Memo8" Left="79,37013" Top="0" Width="71,81107" Height="18,89765" ShowHint="False" DataField="USR$SYSNUM" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="15" ParentFont="False" Text="[Q.&#34;USR$SYSNUM&#34;]"/>
              <TfrxMemoView Name="Memo9" Left="151,1812" Top="0" Width="154,96073" Height="18,89765" ShowHint="False" DataField="USR$NAME" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="15" ParentFont="False" Text="[Q.&#34;USR$NAME&#34;]"/>
              <TfrxMemoView Name="Memo10" Left="306,14193" Top="0" Width="113,3859" Height="18,89765" ShowHint="False" DataField="SUMPAY" DataSet="Q" DataSetName="Q" DisplayFormat.FormatStr="%2.2n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haRight" ParentFont="False" Text="[Q.&#34;SUMPAY&#34;]"/>
              <TfrxMemoView Name="Memo11" Left="612,28386" Top="0" Width="94,48825" Height="18,89765" ShowHint="False" DataField="SUMNCU" DataSet="Q" DataSetName="Q" DisplayFormat.FormatStr="%2.2n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haRight" ParentFont="False" Text="[Q.&#34;SUMNCU&#34;]"/>
              <TfrxMemoView Name="Memo12" Left="517,79561" Top="0" Width="94,48825" Height="18,89765" ShowHint="False" DataField="SUMDISCOUNT" DataSet="Q" DataSetName="Q" DisplayFormat.FormatStr="%2.2n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haRight" ParentFont="False" Text="[Q.&#34;SUMDISCOUNT&#34;]"/>
              <TfrxMemoView Name="Memo13" Left="419,52783" Top="0" Width="98,26778" Height="18,89765" ShowHint="False" DataField="SUMWITHOUTDISCOUNT" DataSet="Q" DataSetName="Q" DisplayFormat.FormatStr="%2.2n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haRight" ParentFont="False" Text="[Q.&#34;SUMWITHOUTDISCOUNT&#34;]"/>
              <TfrxMemoView Name="Memo21" Left="7,55906" Top="0" Width="71,81107" Height="18,89765" ShowHint="False" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="15" ParentFont="False" Text="[Q.&#34;USR$LOGICDATE&#34;]"/>
            </TfrxMasterData>
            <TfrxFooter Name="Footer1" Height="18,89765" Left="0" Top="241,88992" Width="718,1107">
              <TfrxMemoView Name="Memo16" Left="7,55906" Top="0" Width="298,58287" Height="18,89765" ShowHint="False" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="1" Frame.Typ="15" ParentFont="False" Text="РС‚РѕРіРѕ:"/>
              <TfrxMemoView Name="Memo17" Left="306,14193" Top="0" Width="113,3859" Height="18,89765" ShowHint="False" DataSet="Q" DataSetName="Q" DisplayFormat.FormatStr="%2.2n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haRight" ParentFont="False" Text="[SUM(&#60;Q.&#34;SUMPAY&#34;&#62;,MasterData1)]"/>
              <TfrxMemoView Name="Memo18" Left="612,28386" Top="0" Width="94,48825" Height="18,89765" ShowHint="False" DataSet="Q" DataSetName="Q" DisplayFormat.FormatStr="%2.2n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haRight" ParentFont="False" Text="[SUM(&#60;Q.&#34;SUMNCU&#34;&#62;,MasterData1)]"/>
              <TfrxMemoView Name="Memo19" Left="517,79561" Top="0" Width="94,48825" Height="18,89765" ShowHint="False" DataSet="Q" DataSetName="Q" DisplayFormat.FormatStr="%2.2n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haRight" ParentFont="False" Text="[SUM(&#60;Q.&#34;SUMDISCOUNT&#34;&#62;,MasterData1)]"/>
              <TfrxMemoView Name="Memo20" Left="419,52783" Top="0" Width="98,26778" Height="18,89765" ShowHint="False" DataSet="Q" DataSetName="Q" DisplayFormat.FormatStr="%2.2n" DisplayFormat.Kind="fkNumeric" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haRight" ParentFont="False" Text="[SUM(&#60;Q.&#34;SUMWITHOUTDISCOUNT&#34;&#62;,MasterData1)]"/>
            </TfrxFooter>
          </TfrxReportPage>
        </Tgs_fr4SingleReport>
        
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 149273881_2010018534
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 149273880_2010018534
    Fields: 
      NAME: "rp_Main149273881_2010018534"
      COMMENT: ~
      EVENT: ~
      FUNCTIONTYPE: ~
      GROUPNAME: ~
      INHERITEDRULE: 0
      LANGUAGE: "VBScript"
      LOCALNAME: ~
      MODIFYDATE: ~
      MODULE: "REPORTMAIN"
      MODULECODE: "1010001_17 APPLICATION"
      OBJECTNAME: "APPLICATION"
      OWNERNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      USEDEBUGINFO: 0
      EDITIONDATE: 2023-06-09T13:45:46+03:00
      DISPLAYSCRIPT: | 
        RP_MAIN149273881_2010018534
        
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAUEVSSU9EBgAAAM/l8Oju5AAAAAAAAAAAAAAAAAwAAAAAAAAAAAIAAABeUkZO
        U1RQUlNUBAAAAFNUQUYQAAAAyuDw8uAg8e7y8PPk7ejq4EEAAABVU1IkTU5fU1RBRkZDQVJEIGNk
        IGpvaW4gZ2RfY29udGFjdCBjIG9uIGMuaWQgPSBjZC5VU1IkQ09OVEFDVEtFWRIAAABVU1IkTlVN
        QkVSLCBjLm5hbWUCAAAASUQHGgAAAENPQUxFU0NFKFVTUiRESVNBQkxFRCwwKT0wAAAAAAIAAABe
        UkZOU1RGTFBS
      SCRIPT: | 
        Option Explicit
        Function rp_Main149273881_2010018534(period, staf)
          BaseQueryList.Clear
        
          Dim q
          Set q = BaseQueryList.Query(BaseQueryList.Add("q", 0))
          q.SQL = "select " & _
            "  con.name, " & _
            "  O.USR$SYSNUM, o.USR$LOGICDATE, " & _
            "  p.USR$PAYKINDKEY, " & _
            "  pl.USR$TABNUM as TabNum, " & _
            "  p.USR$SUMNCU as sumpay, " & _
            "  pt.USR$NAME, " & _
            "  Sum(iif(p.USR$PAYKINDKEY = :staffpaykindkey, IIF(COALESCE(o.USR$RETURN, 0) = 1, -p.USR$SUMNCU, p.USR$SUMNCU), 0)) as SumNcuStaff, " & _
            "  Sum(IIF(COALESCE(o.USR$RETURN, 0) = 1, -p.USR$SUMNCU, p.USR$SUMNCU)) as Sumncu, " & _
            "  sum((select sum(ol.USR$SUMNCU) from usr$mn_orderline ol where ol.MASTERKEY = o.DOCUMENTKEY)) as SUMWITHOUTDISCOUNT, " & _
            "  sum((select sum(ol.USR$SUMDISCOUNT) from usr$mn_orderline ol where ol.MASTERKEY = o.DOCUMENTKEY)) as SUMDISCOUNT " & _
            "from " & _
            "  usr$mn_order o " & _
            "  left join gd_contact con on con.id = o.USR$STAFFKEY " & _
            "  join gd_people pl on pl.CONTACTKEY = con.id " & _
            "  join usr$mn_payment p on p.USR$ORDERKEY = o.DOCUMENTKEY " & _
            "  left join USR$MN_STAFFCARD ST ON ST.ID = o.USR$STAFFCARDKEY " & _
            "  left join USR$MN_KINDTYPE pt on pt.ID = p.USR$PAYKINDKEY " & _
            "where " & _
            "  o.usr$pay = 1 " & _
            "  and COALESCE(o.USR$RETURN, 0) = 0 " & _
            "  and o.usr$logicdate between :db and :de " & _
            "  AND NOT EXISTS(SELECT * FROM USR$MN_ORDERLINE ol WHERE ol.MASTERKEY = o.DOCUMENTKEY AND ol.USR$REFUND = 1) " & _
            "  and o.USR$STAFFCARDKEY = :STAFFKEY " & _
            "GROUP BY " & _
            "  con.name, O.USR$SYSNUM, p.USR$PAYKINDKEY, pl.USR$TABNUM, p.USR$SUMNCU, pt.USR$NAME, o.USR$LOGICDATE " & _
            "order by " & _
            "  o.USR$LOGICDATE, O.USR$SYSNUM, con.name "
          q.ParamByName("db").asDateTime = period(0)
          q.ParamByName("de").asDateTime = period(1)
          q.ParamByName("staffpaykindkey").AsInteger = gdcBaseManager.GetIDByRUIDString(mn_KindPayment_Credit)
          q.ParambyName("STAFFKEY").asInteger  = staf(0)
          q.Open
          
          dim Title
          set Title = BaseQueryList.Query(BaseQueryList.Add("Title", 1))
          call Title.AddField("DAYBEGIN", "FtDate", 0, 0)
          call Title.AddField("DAYEND", "FtDate", 0, 0)
        
          Title.Open
          Title.Append
          Title.FieldByName("DAYBEGIN").AsString = period(0)
          Title.FieldByName("DAYEND").AsString = period(1)
          Title.Post
        
          Set rp_Main149273881_2010018534 = BaseQueryList
        End Function
        
  - 
    Properties: 
      Class: "TgdcReport"
      RUID: 149273880_2010018534
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      NAME: "06. Детализация чеков по карте"
      DESCRIPTION: ~
      DISPLAYINMENU: 1
      EVENTFORMULAKEY: ~
      FOLDERKEY: "147026409_531839384 Исследователь\\Ресторан\\02. Отчёты\\По сотрудникам"
      FRQREFRESH: 1
      GLOBALREPORTKEY: ~
      ISLOCALEXECUTE: 1
      ISREBUILD: 1
      MAINFORMULAKEY: "149273881_2010018534 rp_Main149273881_2010018534"
      MODALPREVIEW: 0
      PARAMFORMULAKEY: ~
      PREVIEW: 1
      REPORTGROUPKEY: "147094279_157767347 Отчеты по общепиту"
      SERVERKEY: ~
      TEMPLATEKEY: "149274053_2010018534 06. Детализация чеков по карте"
      EDITIONDATE: 2023-06-09T13:45:46+03:00