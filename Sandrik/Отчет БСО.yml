%YAML 1.1
--- 
StructureVersion: "1.0"
Properties: 
  RUID: 211859536_640936098
  Name: "Отчет БСО"
  Caption: "Отчет БСО"
  Version: "1.0.0.1"
  Optional: False
  Internal: True
  MD5: 753ECBBDDA59FDAC45F18769C8CE476D
Objects: 
  - 
    Properties: 
      Class: "TgdcReportGroup"
      RUID: 147035318_65034849
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 211859277_640936098
    Fields: 
      PARENT: ~
      NAME: "01.Бухгалтерия"
      DESCRIPTION: ~
      USERGROUPNAME: "147035318_2000"
      EDITIONDATE: 2000-01-01T00:00:00+03:00
  - 
    Properties: 
      Class: "TgdcReportGroup"
      RUID: 147012352_486813904
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 211859277_640936098
    Fields: 
      PARENT: "147035318_65034849 01.Бухгалтерия"
      NAME: "Движение ОС"
      DESCRIPTION: "Складской учет"
      USERGROUPNAME: "147012352_2000"
      EDITIONDATE: 2000-01-01T00:00:00+03:00
  - 
    Properties: 
      Class: "TgdcTemplate"
      RUID: 211859287_640936098
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 211859277_640936098
    Fields: 
      NAME: "Отчет об использовании бланков211859287_640936098"
      DESCRIPTION: ~
      TEMPLATETYPE: "FR"
      EDITIONDATE: 2020-03-24T16:32:19+03:00
      TEMPLATEDATA: !!binary > 
        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
        QA==
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 211859278_640936098
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 211859277_640936098
    Fields: 
      NAME: "rp_Main148660958_201257706211859278_640936098"
      COMMENT: ~
      EVENT: ~
      FUNCTIONTYPE: ~
      GROUPNAME: ~
      INHERITEDRULE: 0
      LANGUAGE: "VBScript"
      LOCALNAME: ~
      MODIFYDATE: ~
      MODULE: "REPORTMAIN"
      MODULECODE: "1010001_17 APPLICATION"
      OBJECTNAME: "APPLICATION"
      OWNERNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      USEDEBUGINFO: 0
      EDITIONDATE: 2020-03-24T16:41:51+03:00
      DISPLAYSCRIPT: | 
        RP_MAIN148660958_201257706211859278_640936098
        
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QJAAAAREFURUJFR0lOCwAAAMTg8uAg7eD34OvgAAAAAAAAAAAAAAAAAgAAAAAAAAAA
        AAAAAEZOU1RQUlNUBwAAAERBVEVFTkQOAAAAxODy4CDu6u7t9+Dt6P8AAAAAAAAAAAAAAAACAAAA
        AAAAAAAAAAAARk5TVFBSU1QCAAAAVE4EAAAA0s0tMgAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAABG
        TlNUUFJTVAMAAABUVE4FAAAA0tLNLTEAAAAAAAAAAAAAAAAGAAAAAAAAAAAAAAAARk5TVEZMUFI=
      SCRIPT: | 
        function rp_Main148660958_201257706211859278_640936098(DateBegin, DateEnd, TN, TTN)
        
          BaseQueryList.Clear
         if  TTN = false and TN = false Then
           call Application.MessageBox("Укажите хотя бы один тип бланка!" + vbLF + _
                "Выполнение остановлено.","Внимание!", vbOkOnly+vbExclamation+vbSystemModal)
           exit function
         end if
        
          set q = BaseQueryList.Query(BaseQueryList.Add("goodmoney", 0))
          q.SQL = _
          " select " & _
          " doc.number, " & _
          " doc.documentdate, " & _
          " con.Name, " & _
          " doct.Name as MoveType, " & _
          " IIF(doc2.usr$SA_TN=1, 'TN', IIF(doc2.usr$SA_TTN=1, 'TTN', '')) as BSOType " & _
          " from gd_contact con1 " & _
          " JOIN gd_contact con2 ON con2.LB >= con1.LB AND con2.RB <= con1.RB " & _
          " JOIN inv_movement m ON con2.ID = m.contactkey " & _
          " JOIN inv_movement m1 ON m.movementkey = m1.movementkey and m.id <> m1.id " & _
          " LEFT JOIN gd_contact con ON m1.contactkey = con.id " & _
          " LEFT JOIN gd_document doc ON m.documentkey = doc.id " & _
          " LEFT JOIN gd_document doc2 ON doc.parent = doc2.id " & _
          " LEFT JOIN gd_documenttype doct ON doc.documenttypekey = doct.id " & _
          " WHERE " & _
          " con1.id = :contactkey AND " & _
          " m.movementdate >= :datebegin AND " & _
          " m.movementdate <= :dateend AND " & _
          " m.contactkey <> m1.contactkey AND (con.LB < con1.LB OR con.RB > con1.RB) " & _
          " AND doct.id <> 147030959 " & _
          " AND doct.id <> 147031027 " & _
          " AND doct.id <> 147030963 " & _
          " AND(doct.id <> 147030912 OR con.id = 147061368) "
        
          if TN = True and TTN = false then
            q.SQL = q.SQL + " AND doc2.usr$SA_TN = 1 "
          end if
          if TTN = True and TN = false then
            q.SQL = q.SQL + " AND doc2.usr$SA_TTN = 1 "
          end if
          
          if TTN = True and TN = true then
            q.SQL = q.SQL + " and (doc2.usr$SA_TN = 1 or doc2.usr$SA_TTN = 1) "
          end if
          q.SQL = q.SQL + _
          " GROUP BY doc.documentdate, doc.number, con.Name, doct.name, 5  " + _
          " order by  5, doc.number  "
          q.ParamByName("contactkey").AsInteger = IBLogin.CompanyKey
          q.ParamByName("datebegin").AsDateTime = DateBegin
          q.ParamByName("dateend").AsDateTime = DateEnd
          q.Open
        
          set Contact = BaseQueryList.Query(BaseQueryList.Add("Department", 0))
          Contact.SQL = "SELECT * FROM gd_contact WHERE id = :id"
          Contact.ParamByName("id").AsInteger = IBLogin.CompanyKey
          Contact.Open
        
          set Title = BaseQueryList.Query(BaseQueryList.Add("title", 1))
          call Title.AddField("DateBegin", "ftDate", 0, 0)
          call Title.AddField("DateEnd", "ftDate", 0, 0)
          Title.Open
          Title.Edit
          Title.FieldByName("DateBegin").AsVariant = DateBegin
          Title.FieldByName("DateEnd").AsVariant = DateEnd
          Title.Post
        
        
          set rp_Main148660958_201257706211859278_640936098 = BaseQueryList
        end function
        
  - 
    Properties: 
      Class: "TgdcReportGroup"
      RUID: 147011962_109092844
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 211859277_640936098
    Fields: 
      PARENT: "147012352_486813904 01.Бухгалтерия\\Движение ОС"
      NAME: "Отчеты по оптовому складу"
      DESCRIPTION: ~
      USERGROUPNAME: "147011962_109092844"
      EDITIONDATE: 2000-01-01T00:00:00+03:00
  - 
    Properties: 
      Class: "TgdcReport"
      RUID: 211859277_640936098
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      NAME: "Отчет об использовании БСО"
      DESCRIPTION: ~
      DISPLAYINMENU: 1
      EVENTFORMULAKEY: ~
      FOLDERKEY: ~
      FRQREFRESH: 1
      GLOBALREPORTKEY: ~
      ISLOCALEXECUTE: 1
      ISREBUILD: 1
      MAINFORMULAKEY: "211859278_640936098 rp_Main148660958_201257706211859278_640936098"
      MODALPREVIEW: 0
      PARAMFORMULAKEY: ~
      PREVIEW: 1
      REPORTGROUPKEY: "147011962_109092844 01.Бухгалтерия\\Движение ОС\\Отчеты по оптовому складу"
      SERVERKEY: ~
      TEMPLATEKEY: "211859287_640936098 Отчет об использовании бланков211859287_640936098"
      EDITIONDATE: 2020-03-24T16:41:51+03:00