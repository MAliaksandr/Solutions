%YAML 1.1
--- 
StructureVersion: "1.0"
Properties: 
  RUID: 147097335_2004613873
  Name: "Скидка по чекам. Отчет"
  Caption: "Скидка по чекам. Отчет"
  Version: "1.0.0.1"
  Optional: False
  Internal: True
  MD5: 7C37EF3268414D5EB72061DAA6611E72
Uses: 
  - "147023114_301427377 GS.PositiveCheck. Исследователь"
  - "147019071_301427377 GS.PositiveCheck. Отчёты"
Objects: 
  - 
    Properties: 
      Class: "TgdcTemplate"
      RUID: 147097084_2004613873
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147097302_2004613873
    Fields: 
      NAME: "02. Скидки №1147187471_48969208414925956147097084_2004613873"
      DESCRIPTION: ~
      TEMPLATETYPE: "FR"
      EDITIONDATE: 2023-03-06T14:16:53+03:00
      TEMPLATEDATA: !!binary > 
        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
        4kAW1b8K8/flQA==
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 147097303_2004613873
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 147097302_2004613873
    Fields: 
      NAME: "rp_Main147187378_489692084147187462_4896147097303_2004613873"
      COMMENT: ~
      EVENT: ~
      FUNCTIONTYPE: ~
      GROUPNAME: ~
      INHERITEDRULE: 0
      LANGUAGE: "VBScript"
      LOCALNAME: ~
      MODIFYDATE: ~
      MODULE: "REPORTMAIN"
      MODULECODE: "1010001_17 APPLICATION"
      OBJECTNAME: "APPLICATION"
      OWNERNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      USEDEBUGINFO: 0
      EDITIONDATE: 2023-03-06T14:16:54+03:00
      DISPLAYSCRIPT: | 
        RP_MAIN147187378_489692084147187462_4896147097303_2004613873
        
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QCAAAAREILAAAAxODy4CDt4Pfg6+AAAAAAAAAAAAAAAAACAAAAAAAAAAACAAAAXlJG
        TlNUUFJTVAIAAABERQ4AAADE4PLgIO7q7u334O3o/wAAAAAAAAAAAAAAAAIAAAAAAAAAAAIAAABe
        UkZOU1RQUlNUBQAAAENPTlQxBwAAAM/u5O/o8fwOAAAAZ2RfY29udGFjdCBnZzEEAAAAbmFtZQIA
        AABpZAeYAAAAImdnMS5jb250YWN0dHlwZSA9MiBhbmQgRVhJU1RTIChTRUxFQ1QgY29uLmlkIEZS
        T00gZ2RfY29udGFjdCBjb24gd2hlcmUgY29uLmxiIDw9IGdnMS5sYiBhbmQgY29uLnJiID49Z2cx
        LnJiIGFuZCBjb24uaWQgPSAiK0NTdHIoSUJMb2dpbi5Db21wYW55S2V5KSsiKSIIAAAAVkJTY3Jp
        cHQAAAAARk5TVFBSU1QFAAAAQ09OVDIHAAAAz+7k7+jx/A4AAABnZF9jb250YWN0IGdnMQQAAABu
        YW1lAgAAAGlkB5kAAAAiZ2cxLmNvbnRhY3R0eXBlID0gMiBhbmQgRVhJU1RTIChTRUxFQ1QgY29u
        LmlkIEZST00gZ2RfY29udGFjdCBjb24gd2hlcmUgY29uLmxiIDw9IGdnMS5sYiBhbmQgY29uLnJi
        ID49Z2cxLnJiIGFuZCBjb24uaWQgPSAiK0NTdHIoSUJMb2dpbi5Db21wYW55S2V5KSsiKSIIAAAA
        VkJTY3JpcHQAAAAARk5TVEZMUFI=
      SCRIPT: | 
        option explicit
        function rp_Main147187378_489692084147187462_4896147097303_2004613873(db, de, cont1, cont2)
          BaseQueryList.Clear
          Dim q
        
          set q = BaseQueryList.Query(BaseQueryList.Add("qry", 0))
          q.sql = _
          "select " & _
          "  dname.USR$NAME, " & _
          "  d.NUMBER,d.DOCUMENTDATE, " & _
          "  SUM(o.USR$SUMNCU) as SUMNCU, " & _
          "  SUM(o.USR$SUMNCUWITHDISCOUNT) as sumWithDisc, "  & _
          "  SUM(o.usr$discountncu) as discountncu, " & _
          "  SUM(o.usr$guestcount) as guestcount, " & _
          "  count(*) as countcheck " & _
          "from " & _
          "  usr$mn_order o " & _
          "  join usr$mn_discountcard dc on o.usr$disccardkey = dc.id " & _
          "  join USR$MN_DISCOUNTNAME dname on dname.ID = dc.USR$DISCOUNTNAMEKEY " & _
          "  left join gd_document d on d.id = o.documentkey " & _
          "where " & _
          "  o.usr$logicdate >= :db " & _
          "  and o.usr$logicdate <= :de and o.USR$PAY = 1 " & _
          mn_Options.mn_ReportExtraConditions +_
          "GROUP BY " & _
          "  dname.USR$NAME, d.NUMBER ,d.DOCUMENTDATE " & _
          "order by " & _
          "  dname.USR$NAME,  d.DOCUMENTDATE, d.NUMBER"
        
          q.ParamByName("db").AsDateTime = db
          q.ParamByName("de").AsDateTime = de
          q.Open
        
          dim MainFirm
          set MainFirm = BaseQueryList.Query(BaseQueryList.Add("MainFirm", 0))
          MainFirm.SQL = " Select * from GD_V_COMPANY cf WHERE cf.id = " + CSTR(System.company.id)
          MainFirm.open
        
          dim Header
          set Header = BaseQueryList.Query(BaseQueryList.Add("MS", 1))
          call Header.AddField("DAYBEGIN", "FtDate", 0, 0)
          call Header.AddField("DAYEND", "FtDate", 0, 0)
          call Header.AddField("DepName", "FtString", 180, 0)
          Header.Open
          Header.Append
          Header.FieldByName("DAYBEGIN").AsDateTime=db
          Header.FieldByName("DAYEND").AsDateTime=de
          Header.FieldByName("DepName").AsString=mn_Options.CheckLine2
          Header.Post
          
          dim con1, con2
          set con1 = BaseQueryList.Query(BaseQueryList.Add("Cont1", 0))
          con1.SQL = _
           "SELECT " & _
           "C.NAME, " & _
           "P.NICKNAME, " & _
           "WP.NAME AS RANK " & _
           "FROM GD_CONTACT C " & _
           "LEFT JOIN GD_PEOPLE P ON P.CONTACTKEY  = C.ID " & _
           "LEFT JOIN WG_POSITION WP ON WP.ID = P.WPOSITIONKEY " & _
           "WHERE C.ID = " & cont1(0)
          con1.open
          set con2 = BaseQueryList.Query(BaseQueryList.Add("Cont2", 0))
          con2.SQL = _
           "SELECT " & _
           "C.NAME, " & _
           "P.NICKNAME, " & _
           "WP.NAME AS RANK " & _
           "FROM GD_CONTACT C " & _
           "LEFT JOIN GD_PEOPLE P ON P.CONTACTKEY  = C.ID " & _
           "LEFT JOIN WG_POSITION WP ON WP.ID = P.WPOSITIONKEY " & _
           "WHERE C.ID = " & cont2(0)
          con2.open
          
          
          set rp_Main147187378_489692084147187462_4896147097303_2004613873 = BaseQueryList
        end function
        
  - 
    Properties: 
      Class: "TgdcReport"
      RUID: 147097302_2004613873
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      NAME: "06.Скидки (по чекам)"
      DESCRIPTION: ~
      DISPLAYINMENU: 1
      EVENTFORMULAKEY: ~
      FOLDERKEY: "149400407_1533693266 Исследователь\\Ресторан\\02. Отчёты\\По скидкам"
      FRQREFRESH: 1
      GLOBALREPORTKEY: ~
      ISLOCALEXECUTE: 1
      ISREBUILD: 1
      MAINFORMULAKEY: "147097303_2004613873 rp_Main147187378_489692084147187462_4896147097303_2004613873"
      MODALPREVIEW: 0
      PARAMFORMULAKEY: ~
      PREVIEW: 1
      REPORTGROUPKEY: "147354266_415245150 Отчеты по общепиту\\Новые отчёты менеджеров"
      SERVERKEY: ~
      TEMPLATEKEY: "147097084_2004613873 02. Скидки №1147187471_48969208414925956147097084_2004613873"
      EDITIONDATE: 2023-03-06T14:16:54+03:00