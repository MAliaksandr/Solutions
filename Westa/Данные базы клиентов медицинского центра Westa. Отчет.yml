%YAML 1.1
--- 
StructureVersion: "1.0"
Properties: 
  RUID: 187943274_1964217046
  Name: "Данные базы клиентов медицинского центра Westa. Отчет"
  Caption: "Данные базы клиентов медицинского центра Westa. Отчет"
  Version: "1.0.0.1"
  Optional: False
  Internal: True
  MD5: 20EE92ED23127B9416CBF90AEB4CC699
Uses: 
  - "147378222_789097196 GS.Клиентские решения.Westa.Калькуляция услуги"
  - "149970829_837256873 GS.Клиентские решения.WESTA.Экономист.Отчеты"
  - "147378329_789097196 GS.Клиентские решения.WESTA.Экономист.Договор на оказание услуг"
Objects: 
  - 
    Properties: 
      Class: "TgdcTemplate"
      RUID: 166988059_1192700761
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 166988049_1192700761
    Fields: 
      NAME: "Экономист.Договор на оказ. услуг.Данные 166988059_1192700761"
      DESCRIPTION: ~
      TEMPLATETYPE: "FR4"
      EDITIONDATE: 2022-10-14T22:34:15+03:00
      TEMPLATEDATA: | 
        <?xml version="1.0" encoding="utf-8"?>
        <Tgs_fr4SingleReport Version="4.15.13" DotMatrixReport="False" IniFile="\Software\Fast Reports" PreviewOptions.Buttons="4095" PreviewOptions.Zoom="1" PrintOptions.Printer="По умолчанию" PrintOptions.PrintOnSheet="0" ReportOptions.CreateDate="43762,5178295486" ReportOptions.Description.Text="" ReportOptions.LastChange="43762,5178295486" ScriptLanguage="PascalScript" ScriptText.Text="var str: string;                                  &#13;&#10;procedure Memo15OnBeforePrint(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  str:= &#60;Q.&#34;COUNTRY&#34;&#62;;&#13;&#10;  if ((str &#60;&#62; '') and (&#60;Q.&#34;CITY&#34;&#62; &#60;&#62; '')) then str:= str + ', ';&#13;&#10;  str:= str + &#60;Q.&#34;CITY&#34;&#62;;&#13;&#10;  if ((str &#60;&#62; '') and (&#60;Q.&#34;ADDRESS&#34;&#62; &#60;&#62; '')) then str:= str + ', ';      &#13;&#10;  str:= str + &#60;Q.&#34;ADDRESS&#34;&#62;;&#13;&#10;                 &#13;&#10;  &#13;&#10;end;&#13;&#10;&#13;&#10;begin&#13;&#10;&#13;&#10;end." PropData="08446174617365747301010C2600000020446174615365743D2247524C4953542220446174615365744E616D653D2247524C4953542200010C2C00000020446174615365743D22504C4143454C4953542220446174615365744E616D653D22504C4143454C4953542200010C1C00000020446174615365743D22512220446174615365744E616D653D2251220000095661726961626C65730100055374796C650100">
          <TfrxDataPage Name="Data" Height="1000" Left="0" Top="0" Width="1000"/>
          <TfrxReportPage Name="Page1" Orientation="poLandscape" PaperWidth="297" PaperHeight="210" PaperSize="9" LeftMargin="6,61458333333333" RightMargin="6,61458333333333" TopMargin="6,61458333333333" BottomMargin="6,61458333333333" ColumnWidth="0" ColumnPositions.Text="" HGuides.Text="" VGuides.Text="">
            <TfrxReportTitle Name="ReportTitle1" Height="124,57483" Left="0" Top="18,89765" Width="1072,52037770833">
              <TfrxMemoView Name="Memo1" Align="baWidth" Left="0" Top="12" Width="1072,52037770833" Height="56,66141" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-21" Font.Name="Arial" Font.Style="1" HAlign="haCenter" ParentFont="False" Text="Р”Р°РЅРЅС‹Рµ РґР»СЏ С„РѕСЂРјРёСЂРѕРІР°РЅРёСЏ Р±Р°Р·С‹ РєР»РёРµРЅС‚РѕРІ РјРµРґРёС†РёРЅСЃРєРѕРіРѕ С†РµРЅС‚СЂР° Westa &#13;&#10;Р·Р° РїРµСЂРёРѕРґ СЃ [PARAM0s0] РїРѕ [PARAM0s1]"/>
              <TfrxMemoView Name="Memo16" Left="3,77953" Top="71,81107" Width="1069,60699" Height="52,91342" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" ParentFont="False" Text="[IIF(&#60;GRLIST.&#34;GR&#34;&#62;&#60;&#62;'','РЈСЃР»СѓРіРё:' + &#60;GRLIST.&#34;GR&#34;&#62;,'РџРѕ РІСЃРµРј СѓСЃР»СѓРіР°Рј')]&#13;&#10;[IIF(&#60;PLACELIST.&#34;LSITY&#34;&#62;&#60;&#62;'','РџРѕ РіРѕСЂРѕРґР°Рј:' + &#60;PLACELIST.&#34;LSITY&#34;&#62;,'РџРѕ РІСЃРµРј СЂРµРіРёРѕРЅР°Рј')]"/>
            </TfrxReportTitle>
            <TfrxHeader Name="Header1" Height="44" Left="0" Top="204,09462" Width="1072,52037770833">
              <TfrxMemoView Name="Memo8" Align="baLeft" Left="0" Top="0" Width="253" Height="44" ShowHint="False" StretchMode="smMaxHeight" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="Р¤.Р.Рћ."/>
              <TfrxMemoView Name="Memo9" Align="baLeft" Left="253" Top="0" Width="76" Height="44" ShowHint="False" StretchMode="smMaxHeight" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="Р”Р°С‚Р° СЂРѕР¶РґРµРЅРёСЏ"/>
              <TfrxMemoView Name="Memo10" Align="baLeft" Left="570" Top="0" Width="106" Height="44" ShowHint="False" StretchMode="smMaxHeight" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РўРµР»РµС„РѕРЅ"/>
              <TfrxMemoView Name="Memo11" Align="baLeft" Left="676" Top="0" Width="134" Height="44" ShowHint="False" StretchMode="smMaxHeight" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="E-mail"/>
              <TfrxMemoView Name="Memo12" Align="baLeft" Left="810" Top="0" Width="79" Height="44" ShowHint="False" StretchMode="smMaxHeight" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="Р”Р°С‚Р° РѕР±СЂР°С‰РµРЅРёСЏ"/>
              <TfrxMemoView Name="Memo13" Align="baLeft" Left="889" Top="0" Width="184" Height="44" ShowHint="False" StretchMode="smMaxHeight" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РћРєР°Р·Р°РЅРЅР°СЏ СѓСЃР»СѓРіР°"/>
              <TfrxMemoView Name="Memo14" Align="baLeft" Left="329" Top="0" Width="241" Height="44" ShowHint="False" StretchMode="smMaxHeight" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РђРґСЂРµСЃ"/>
            </TfrxHeader>
            <TfrxMasterData Name="MasterData1" Height="36" Left="0" Top="272,12616" Width="1072,52037770833" ColumnWidth="0" ColumnGap="0" DataSet="Q" DataSetName="Q" RowCount="0" Stretched="True">
              <TfrxMemoView Name="Memo2" Align="baLeft" Left="0" Top="0" Width="253" Height="36" ShowHint="False" StretchMode="smMaxHeight" DataField="NAME" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;NAME&#34;]"/>
              <TfrxMemoView Name="Memo3" Align="baLeft" Left="253" Top="0" Width="76" Height="36" ShowHint="False" StretchMode="smMaxHeight" DataField="BIRTHDAY" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;BIRTHDAY&#34;]"/>
              <TfrxMemoView Name="Memo4" Align="baLeft" Left="570" Top="0" Width="106" Height="36" ShowHint="False" StretchMode="smMaxHeight" DataField="PHONE" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;PHONE&#34;]"/>
              <TfrxMemoView Name="Memo5" Align="baLeft" Left="676" Top="0" Width="134" Height="36" ShowHint="False" StretchMode="smMaxHeight" DataField="EMAIL" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;EMAIL&#34;]"/>
              <TfrxMemoView Name="Memo6" Align="baLeft" Left="810" Top="0" Width="79" Height="36" ShowHint="False" StretchMode="smMaxHeight" DataField="DOCUMENTDATE" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;DOCUMENTDATE&#34;]"/>
              <TfrxMemoView Name="Memo7" Align="baLeft" Left="889" Top="0" Width="184" Height="36" ShowHint="False" StretchMode="smMaxHeight" DataField="GROUPNAME" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;GROUPNAME&#34;]"/>
              <TfrxMemoView Name="Memo15" Align="baLeft" Left="329" Top="0" Width="241" Height="36" OnBeforePrint="Memo15OnBeforePrint" ShowHint="False" StretchMode="smMaxHeight" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" Frame.Typ="15" ParentFont="False" VAlign="vaCenter" Text="[str]"/>
            </TfrxMasterData>
          </TfrxReportPage>
        </Tgs_fr4SingleReport>
        
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 166988050_1192700761
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 166988049_1192700761
    Fields: 
      NAME: "rp_Main166557436_1328400198166988050_1192700761"
      COMMENT: ~
      EVENT: ~
      FUNCTIONTYPE: ~
      GROUPNAME: ~
      INHERITEDRULE: 0
      LANGUAGE: "VBScript"
      LOCALNAME: ~
      MODIFYDATE: ~
      MODULE: "REPORTMAIN"
      MODULECODE: "1010001_17 APPLICATION"
      OBJECTNAME: "APPLICATION"
      OWNERNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      USEDEBUGINFO: 0
      EDITIONDATE: 2022-10-14T22:34:15+03:00
      DISPLAYSCRIPT: | 
        RP_MAIN166557436_1328400198166988050_1192700761
        
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAUEVSSU9EBgAAAM/l8Oju5AAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAABGTlNU
        UFJTVAIAAABHUgYAAADT8evz4+gMAAAAZ2RfZ29vZGdyb3VwBAAAAG5hbWUCAAAAaWQIAAAAAAAA
        AAAAAAAARk5TVFBSU1QGAAAAUkVHSU9OEAAAAMPu8O7kIO/w7ubo4uDt6P8IAAAAR0RfUExBQ0UE
        AAAAbmFtZQIAAABpZAgWAAAAUExBQ0VUWVBFPSfN4PEuIO/z7eryJwAAAAACAAAAXkFGTlNUUFJT
        VAQAAABTT1JUDwAAANHu8PLo8O7i4PL8IO/uOgAAAAAAAAAAAAAAAA4AAAAAAAAAALIAAABeViLK
        6+jl7fIv5ODy4C/z8evz4+A9Y29udC5uYW1lLCBkb2MuRE9DVU1FTlREQVRFLCBnZy5uYW1lIiwg
        ItPx6/Pj4C/q6+jl7fIv5ODy4D0gZ2cubmFtZSwgY29udC5uYW1lLCBkb2MuRE9DVU1FTlREQVRF
        LCIsIsTg8uAv6ujl7fIv8/Hr8+PgPSBkb2MuRE9DVU1FTlREQVRFLCBjb250Lm5hbWUsIGdnLm5h
        bWUiRk5TVEZMUFI=
      SCRIPT: | 
        Option Explicit
        Function rp_Main166557436_1328400198166988050_1192700761(Period, gr, Region, sort)
          BaseQueryList.Clear
        
          dim grID, whereStr, RegionID, groupStr
          grID = Join(gr, ",")
          RegionID = Join(Region, ",")
          whereStr = ""
          
          dim qGrList
          set qGrList = BaseQueryList.Query(BaseQueryList.Add("GrList", 0))
          qGrList.SQL = _
            "SELECT CAST(LIST(COALESCE(NAME,''),'; ') as BLOB) AS GR FROM GD_GOODGROUP "
            
          dim qPlaceList
          set qPlaceList = BaseQueryList.Query(BaseQueryList.Add("PlaceList", 0))
          qPlaceList.SQL = _
             "SELECT CAST(LIST(COALESCE(NAME,''),'; ') as BLOB) AS LSITY FROM GD_PLACE "
             
          if grID <> "" Then
             whereStr = " and gg.id in (" + grID + ") "
             qGrList.SQL =  qGrList.SQL + " WHERE ID IN (" + grID + ") "
             qGrList.FetchBlob = 1
             qGrList.Open
          else
             qGrList.SQL =  qGrList.SQL + " WHERE ID IS NULL "
             qGrList.Open
          end if
          if RegionID <> "" Then
             whereStr = " and cont.PLACEKEY in (" + RegionID + ") "
             qPlaceList.SQL = qPlaceList.SQL  + " WHERE ID IN (" + RegionID + ") "
             qPlaceList.FetchBlob = 1
             qPlaceList.Open
          else
             qPlaceList.SQL = qPlaceList.SQL  + " WHERE ID IS NULL "
             qPlaceList.Open
          end if
          
          
        
        
          
          
          Dim q
          Set q = BaseQueryList.Query(BaseQueryList.Add("q", 0))
          q.SQL = _
          "  SELECT DISTINCT " & _
          "    cont.name, p.BIRTHDAY, cont.PHONE, cont.EMAIL, " & _
          "    COALESCE(p.HCOUNTRY, cont.COUNTRY) as  COUNTRY, " & _
          "    COALESCE(p.HCITY, cont.CITY) as  CITY, " & _
          "    COALESCE(p.HADDRESS, cont.ADDRESS) as  ADDRESS, " & _
          "    doc.DOCUMENTDATE, gg.name as GROUPNAME " & _
          "  FROM USR$CONTRACT_PROVIDING c " & _
          "  LEFT JOIN USR$CONTRACT_PROVIDINGLINE cl on cl.MASTERKEY = c.DOCUMENTKEY " & _
          "  LEFT JOIN GD_GOOD g on g.ID = cl.USR$SERVICEKEY " & _
          "  LEFT JOIN GD_GOODGROUP gg on gg.id = g.GROUPKEY " & _
          "  JOIN GD_DOCUMENT doc on c.DOCUMENTKEY = doc.id " & _
          "  LEFT JOIN GD_CONTACT cont on cont.ID = c.USR$CLIENT " & _
          "  LEFT JOIN GD_PEOPLE p on p.CONTACTKEY = cont.ID " & _
          "  WHERE doc.DOCUMENTDATE >= :db and doc.DOCUMENTDATE <= :de " & _
          whereStr & _
          "  ORDER BY " & sort
          q.ParamByName("db").AsDateTime = Period(0)
          q.ParamByName("de").AsDateTime = Period(1)
          q.Open
        
          Set rp_Main166557436_1328400198166988050_1192700761 = BaseQueryList
        End Function
        
  - 
    Properties: 
      Class: "TgdcReport"
      RUID: 166988049_1192700761
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      NAME: "Данные базы клиентов медицинского центра Westa"
      DESCRIPTION: ~
      DISPLAYINMENU: 1
      EVENTFORMULAKEY: ~
      FOLDERKEY: "149970783_837256873 Исследователь\\2. Экономист\\ Отчеты"
      FRQREFRESH: 1
      GLOBALREPORTKEY: ~
      ISLOCALEXECUTE: 1
      ISREBUILD: 1
      MAINFORMULAKEY: "166988050_1192700761 rp_Main166557436_1328400198166988050_1192700761"
      MODALPREVIEW: 0
      PARAMFORMULAKEY: ~
      PREVIEW: 1
      REPORTGROUPKEY: "147067501_704999368 Документы пользователя\\16. Договор на оказание услуг"
      SERVERKEY: ~
      TEMPLATEKEY: "166988059_1192700761 Экономист.Договор на оказ. услуг.Данные 166988059_1192700761"
      EDITIONDATE: 2022-10-14T22:34:15+03:00