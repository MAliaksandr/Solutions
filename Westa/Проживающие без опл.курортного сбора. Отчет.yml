%YAML 1.1
--- 
StructureVersion: "1.0"
Properties: 
  RUID: 175836946_1192700761
  Name: "Проживающие без опл.курортного сбора. Отчет"
  Caption: "Проживающие без опл.курортного сбора. Отчет"
  Version: "1.0.0.1"
  Optional: False
  Internal: True
  MD5: 3596C99262F932EAEC9AA1688BD81B07
Uses: 
  - "147364159_796152036 GS.Санаторий.Отдел продаж.Исследователь"
  - "147755479_69526485 GS.Общие.EVT_OBJECT"
  - "147376588_789097196 VESTA.Заявка"
Objects: 
  - 
    Properties: 
      Class: "TgdcTemplate"
      RUID: 164720376_1274276790
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 164720306_1274276790
    Fields: 
      NAME: "HT. Проживающие без курортного сбора"
      DESCRIPTION: ~
      TEMPLATETYPE: "FR4"
      EDITIONDATE: 2019-11-26T10:22:31+03:00
      TEMPLATEDATA: | 
        <?xml version="1.0" encoding="utf-8"?>
        <Tgs_fr4SingleReport Version="4.15.13" DotMatrixReport="False" IniFile="\Software\Fast Reports" PreviewOptions.Buttons="4095" PreviewOptions.Zoom="1" PrintOptions.Printer="По умолчанию" PrintOptions.PrintOnSheet="0" ReportOptions.CreateDate="43661,5194467708" ReportOptions.Description.Text="" ReportOptions.LastChange="43661,5194467708" ScriptLanguage="PascalScript" ScriptText.Text="begin&#13;&#10;&#13;&#10;end." PropData="08446174617365747301010C1C00000020446174615365743D22512220446174615365744E616D653D22512200010C2400000020446174615365743D2251484F55532220446174615365744E616D653D2251484F5553220000095661726961626C65730100055374796C650100">
          <TfrxDataPage Name="Data" Height="1000" Left="0" Top="0" Width="1000"/>
          <TfrxReportPage Name="Page1" PaperWidth="210" PaperHeight="297" PaperSize="9" LeftMargin="10" RightMargin="10" TopMargin="10" BottomMargin="10" ColumnWidth="0" ColumnPositions.Text="" HGuides.Text="" VGuides.Text="">
            <TfrxReportTitle Name="ReportTitle1" Height="56,69295" Left="0" Top="18,89765" Width="718,1107">
              <TfrxMemoView Name="Memo1" Align="baWidth" Left="0" Top="0" Width="718,1107" Height="37,7953" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="1" HAlign="haCenter" ParentFont="False" Text="РџСЂРѕР¶РёРІР°СЋС‰РёРµ Р±РµР· РѕРїР»Р°С‚С‹ РєСѓСЂРѕСЂС‚РЅРѕРіРѕ СЃР±РѕСЂР°&#13;&#10;Р·Р° РїРµСЂРёРѕРґ СЃ [PARAM0s0] РїРѕ [PARAM0s1]"/>
              <TfrxMemoView Name="Memo31" Align="baWidth" Left="0" Top="37,7953" Width="718,1107" Height="18,89765" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-13" Font.Name="Arial" Font.Style="0" HAlign="haRight" ParentFont="False" Text="[QHOUS.&#34;HOUSENAME&#34;]"/>
            </TfrxReportTitle>
            <TfrxHeader Name="Header1" Height="37,7953" Left="0" Top="136,06308" Width="718,1107">
              <TfrxMemoView Name="Memo2" Align="baLeft" Left="151,1812" Top="0" Width="41,57483" Height="37,7953" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="в„– РєРѕРјРЅ."/>
              <TfrxMemoView Name="Memo3" Align="baLeft" Left="192,75603" Top="0" Width="120,94496" Height="37,7953" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="Р¤РРћ РїСЂРѕР¶РёРІР°СЋС‰РµРіРѕ"/>
              <TfrxMemoView Name="Memo5" Align="baLeft" Left="22,67718" Top="0" Width="64,25201" Height="37,7953" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="Р”Р°С‚Р° Р·Р°РµР·РґР°"/>
              <TfrxMemoView Name="Memo6" Align="baLeft" Left="313,70099" Top="0" Width="64,251968503937" Height="37,7953" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="Р”Р°С‚Р° СЂРѕР¶РґРµРЅРёСЏ"/>
              <TfrxMemoView Name="Memo7" Align="baLeft" Left="495,118388503937" Top="0" Width="52,91342" Height="37,7953" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="в„– РїСѓС‚РµРІРєРё"/>
              <TfrxMemoView Name="Memo8" Align="baLeft" Left="548,031808503937" Top="0" Width="71,81107" Height="37,7953" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РЎСѓРјРјР° РїСѓС‚РµРІРєРё"/>
              <TfrxMemoView Name="Memo16" Align="baLeft" Left="619,842878503937" Top="0" Width="98,26778" Height="37,7953" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РљРѕРјРјРµРЅС‚Р°СЂРёР№"/>
              <TfrxMemoView Name="Memo11" Align="baLeft" Left="86,92919" Top="0" Width="64,25201" Height="37,7953" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="Р”Р°С‚Р° РІС‹РµР·РґР°"/>
              <TfrxMemoView Name="Memo19" Align="baLeft" Left="377,952958503937" Top="0" Width="117,16543" Height="37,7953" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="РўРёРї РїСѓС‚РµРІРєРё"/>
              <TfrxMemoView Name="Memo4" Align="baLeft" Left="0" Top="0" Width="22,67718" Height="37,7953" ShowHint="False" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haCenter" ParentFont="False" VAlign="vaCenter" Text="в„–"/>
            </TfrxHeader>
            <TfrxMasterData Name="MasterData1" Height="22,67718" Left="0" Top="196,53556" Width="718,1107" ColumnWidth="0" ColumnGap="0" DataSetName="Q" RowCount="0" Stretched="True">
              <TfrxMemoView Name="Memo9" Align="baLeft" Left="151,1812" Top="0" Width="41,57483" Height="22,67718" ShowHint="False" StretchMode="smMaxHeight" DataField="N" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haCenter" HideZeros="True" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;N&#34;]"/>
              <TfrxMemoView Name="Memo10" Align="baLeft" Left="192,75603" Top="0" Width="120,94496" Height="22,67718" ShowHint="False" StretchMode="smMaxHeight" DataField="CONNAME" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HideZeros="True" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;CONNAME&#34;]"/>
              <TfrxMemoView Name="Memo12" Align="baLeft" Left="22,67718" Top="0" Width="64,25201" Height="22,67718" ShowHint="False" StretchMode="smMaxHeight" DataField="USR$DATEBEGIN" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haCenter" HideZeros="True" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;USR$DATEBEGIN&#34;]"/>
              <TfrxMemoView Name="Memo13" Align="baLeft" Left="313,70099" Top="0" Width="64,251968503937" Height="22,67718" ShowHint="False" StretchMode="smMaxHeight" DataField="BIRTHDAY" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haCenter" HideZeros="True" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;BIRTHDAY&#34;]"/>
              <TfrxMemoView Name="Memo14" Align="baLeft" Left="495,118388503937" Top="0" Width="52,91342" Height="22,67718" ShowHint="False" StretchMode="smMaxHeight" TagStr="[Q.&#34;ID&#34;]" DataField="NUMBER" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haCenter" HideZeros="True" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;NUMBER&#34;]"/>
              <TfrxMemoView Name="Memo15" Align="baLeft" Left="548,031808503937" Top="0" Width="71,81107" Height="22,67718" ShowHint="False" StretchMode="smMaxHeight" DataField="S" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haRight" HideZeros="True" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;S&#34;]"/>
              <TfrxMemoView Name="Memo17" Align="baLeft" Left="619,842878503937" Top="0" Width="98,26778" Height="22,67718" ShowHint="False" StretchMode="smMaxHeight" DataField="USR$COMMENTTAX" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HideZeros="True" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;USR$COMMENTTAX&#34;]"/>
              <TfrxMemoView Name="Memo18" Align="baLeft" Left="86,92919" Top="0" Width="64,25201" Height="22,67718" ShowHint="False" StretchMode="smMaxHeight" DataField="USR$DATEEND" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haCenter" HideZeros="True" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;USR$DATEEND&#34;]"/>
              <TfrxMemoView Name="Memo20" Align="baLeft" Left="377,952958503937" Top="0" Width="117,16543" Height="22,67718" ShowHint="False" StretchMode="smMaxHeight" DataField="TYPENAME" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-11" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HideZeros="True" ParentFont="False" VAlign="vaCenter" Text="[Q.&#34;TYPENAME&#34;]"/>
              <TfrxMemoView Name="Memo21" Align="baLeft" Left="0" Top="0" Width="22,67718" Height="22,67718" ShowHint="False" StretchMode="smMaxHeight" DataSet="Q" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="0" Frame.Typ="15" HAlign="haCenter" HideZeros="True" ParentFont="False" VAlign="vaCenter" Text="[Line#]"/>
            </TfrxMasterData>
            <TfrxFooter Name="Footer1" Height="22,67718" Left="0" Top="241,88992" Width="718,1107">
              <TfrxMemoView Name="Memo22" Align="baLeft" Left="0" Top="0" Width="548,03185" Height="22,67718" ShowHint="False" StretchMode="smMaxHeight" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haRight" HideZeros="True" ParentFont="False" VAlign="vaCenter" Text="РС‚РѕРіРѕ:"/>
              <TfrxMemoView Name="Memo25" Align="baLeft" Left="548,03185" Top="0" Width="71,81107" Height="22,67718" ShowHint="False" StretchMode="smMaxHeight" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HAlign="haRight" HideZeros="True" ParentFont="False" VAlign="vaCenter" Text="[SUM(&#60;Q.&#34;S&#34;&#62;)]"/>
              <TfrxMemoView Name="Memo26" Align="baLeft" Left="619,84292" Top="0" Width="98,26778" Height="22,67718" ShowHint="False" StretchMode="smMaxHeight" DataSetName="Q" Font.Charset="1" Font.Color="0" Font.Height="-12" Font.Name="Arial" Font.Style="1" Frame.Typ="15" HideZeros="True" ParentFont="False" VAlign="vaCenter" Text=""/>
            </TfrxFooter>
          </TfrxReportPage>
        </Tgs_fr4SingleReport>
        
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 164720704_1274276790
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 164720306_1274276790
    Fields: 
      NAME: "rp_Event164720704_1274276790"
      COMMENT: ~
      EVENT: ~
      FUNCTIONTYPE: ~
      GROUPNAME: ~
      INHERITEDRULE: 0
      LANGUAGE: "VBScript"
      LOCALNAME: ~
      MODIFYDATE: ~
      MODULE: "REPORTEVENT"
      MODULECODE: "1010001_17 APPLICATION"
      OBJECTNAME: "APPLICATION"
      OWNERNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      USEDEBUGINFO: 0
      EDITIONDATE: 2019-07-15T18:10:22+03:00
      DISPLAYSCRIPT: | 
        RP_EVENT164720704_1274276790
        
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAUEFSQU1TBgAAAFBBUkFNUwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNU
        UFJTVAUAAABWQUxVRQUAAABWQUxVRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABGTlNUUFJTVAQA
        AABOQU1FBAAAAE5BTUUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAARk5TVEZMUFI=
      SCRIPT: | 
        Option Explicit
        Function rp_Event164720704_1274276790(Params, Value, Name)
          'Результат возвращаемый функцией должен быть True или False
          '  Если функция вернет True, то произойдет закрытие окна предварительного просмотра
            if Value(1) <> "" then
        
            dim Creator, Document, ibSQl
            set Creator = new TCreator
            set Document = Creator.GetObject(NULL, "TgdcUserDocument", "")
            Document.SubType = "147188916_779589892"
            Document.SubSet = "ByID"
            Document.ID = Value(1)
            Document.Open
            Document.EditDialog("")
          end if
          rp_Event164720704_1274276790 = False
        End Function
        
  - 
    Properties: 
      Class: "TgdcFunction"
      RUID: 164720307_1274276790
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
      HeadObject: 164720306_1274276790
    Fields: 
      NAME: "rp_Main164720307_1274276790"
      COMMENT: ~
      EVENT: ~
      FUNCTIONTYPE: ~
      GROUPNAME: ~
      INHERITEDRULE: 0
      LANGUAGE: "VBScript"
      LOCALNAME: ~
      MODIFYDATE: ~
      MODULE: "REPORTMAIN"
      MODULECODE: "1010001_17 APPLICATION"
      OBJECTNAME: "APPLICATION"
      OWNERNAME: ~
      PUBLICFUNCTION: 1
      SHORTCUT: ~
      USEDEBUGINFO: 0
      EDITIONDATE: 2021-08-02T17:13:41+03:00
      DISPLAYSCRIPT: | 
        RP_MAIN164720307_1274276790
        
      ENTEREDPARAMS: !!binary > 
        U0xQUlBSU1QGAAAAUEVSSU9EBgAAAM/l8Oju5AAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAABGTlNU
        UFJTVAoAAABIT1VTSU5HS0VZBgAAAMru8O/z8Q4AAABVU1IkSFRfSE9VU0lORwgAAABVU1IkTkFN
        RQIAAABJRAgAAAAAAAAAAAAAAABGTlNUUFJTVA0AAABQRVJNSVRUWVBFS0VZCwAAANLo7yDv8/Ll
        4u7qEwAAAFVTUiRTQU5fUEVSTUlUX1RZUEUIAAAAVVNSJE5BTUULAAAARE9DVU1FTlRLRVkIZwAA
        AEVYSVNUUyhTRUxFQ1QgZG9jLklEIEZST00gR0RfRE9DVU1FTlQgZG9jIFdIRVJFIGRvYy5JRCA9
        IERPQ1VNRU5US0VZIEFORCBDT0FMRVNDRShkb2MuRElTQUJMRUQsIDApID0gMCkAAAAAAgAAAF5B
        Rk5TVEZMUFI=
      SCRIPT: | 
        Option Explicit
        Function rp_Main164720307_1274276790(Period, HousingKey, PermitTypeKey)
          BaseQueryList.Clear
          dim strWhere
        
          Dim qHous
          Set qHous = BaseQueryList.Query(BaseQueryList.Add("qHous", 0))
        
          if Join(HousingKey, ",") <> "" then
            strWhere = strWhere & " AND numb.USR$HOUSINGKEY IN (" &  Join(HousingKey, ",") & ") "
        
            qHous.SQL = " SELECT LIST(USR$NAME, ', ') AS HOUSENAME " & VBCR & _
              " FROM USR$HT_HOUSING WHERE ID IN (" &  Join(HousingKey, ",") & ") "
            qHous.FetchBlob = true
          else
            qHous.SQL = " SELECT FIRST 1 'По всем корпусам' AS HOUSENAME " & VBCR & _
              " FROM USR$HT_HOUSING WHERE 1=1 "
          end if
          qHous.Open
        
          if  Join(PermitTypeKey, ",") <> "" then
            strWhere = strWhere & " AND r.USR$TYPE_PERMIT IN (" &  Join(PermitTypeKey, ",") & ") "
          end if
        
        
          Dim q
          Set q = BaseQueryList.Query(BaseQueryList.Add("q", 0))
          q.SQL ="    SELECT " & _
            "     numb.USR$NAME AS N, " & _
            "     p.NICKNAME AS CONNAME, " & _
            "     r.USR$RESORTTAXRATE, " & _
            "     r.USR$DATEBEGIN, " & _
            "     r.USR$DATEEND, " & _
            "     p.BIRTHDAY, " & _
            "     r.USR$NUMBER AS NUMBER, " & _
            "     IIF(COALESCE(r.USR$SUMRUR,0)=0 OR (CPAY.PARENT=<RUID XID=""147222257"" DBID=""779589892""/> /*тур.фирмы*/), " & _
            "     ROUND(IIF(COALESCE(r.USR$MANUALPRICE, 0) = 1 AND r.USR$CURRKEY = 200010, r.USR$TOTALPARTSUM,  r.USR$SUMNCU), 2), " & _
            "     ROUND(IIF(COALESCE(r.USR$MANUALPRICE, 0) = 1, r.USR$TOTALPARTSUM*CC.RATE,  r.USR$SUMRUR * CCrur.RATE),2) " & _
            "     ) as S, tt.USR$NAME AS TYPENAME, " & _
            "     r.USR$COMMENTTAX, r.USR$REQUESTKEY AS ID " & _
            "    FROM USR$HT_RESERVATION r " & _
            "    LEFT JOIN GD_PEOPLE p ON p.CONTACTKEY = r.USR$CONTACTKEY " & _
            "    LEFT JOIN USR$HT_NUMBER numb ON numb.ID = r.USR$NUMBERKEY " & _
            "    LEFT JOIN USR$HT_HOUSING house ON numb.USR$HOUSINGKEY = house.ID " & _
            "    LEFT JOIN USR$SAN_REQUEST SR on r.USR$REQUESTKEY = SR.DOCUMENTKEY " & _
            "    LEFT JOIN GD_CONTACT CPAY ON CPAY.ID = SR.USR$CONTACTKEY " & _
            "    LEFT JOIN USR$SAN_PERMIT_TYPE tt ON tt.DOCUMENTKEY = r.USR$TYPE_PERMIT " & _
            "    LEFT JOIN USR$HT_INVOICE inv ON inv.DOCUMENTKEY  =  r.USR$HTINVOICEKEY " & _
            "    LEFT JOIN USR$HT_GETNOPAYRESERV(r.ID) NP on 1=1 " & _
            "    LEFT JOIN USR$GS_P_GETCURRRATE(r.USR$CURRKEY, " & _
            "     IIF(coalesce(cpay.USR$ISORGNOTRES, 0) = 1 or (r.USR$CLIENTCATEGORYKEY = :CAT and not r.USR$CURRKEY in (200050, 200010) ),  (SELECT first 1 doc.DOCUMENTDATE " & _
            "      FROM USR$SAN_INVOICE inv " & _
            "      LEFT JOIN GD_DOCUMENT doc ON doc.ID = inv.DOCUMENTKEY " & _
            "      WHERE inv.DOCUMENTKEY IN " & _
            "       ( SELECT INV.DOCUMENTKEY " & _
            "         FROM USR$HT_RESERVATION RES " & _
            "         LEFT JOIN USR$SAN_INVOICE INV ON (INV.USR$CONTROCCKEY = RES.USR$CONTROCCKEY OR INV.USR$REQUESTKEY = RES.USR$REQUESTKEY ) " & _
            "         WHERE RES.USR$REQUESTKEY = R.USR$REQUESTKEY AND RES.ID = R.ID) " & _
            "      ORDER BY doc.DOCUMENTDATE desc), " & _
            "     IIF((NP.PAYDATE>R.USR$DATEBEGIN) OR (NP.PAYDATE is Null),R.USR$DATEBEGIN,NP.PAYDATE))) CC on 1=1 " & _
            "   LEFT JOIN USR$GS_P_GETCURRRATE(200050, " & _
            "    IIF(coalesce(cpay.USR$ISORGNOTRES, 0) = 1  or (r.USR$CLIENTCATEGORYKEY = :CAT and not r.USR$CURRKEY in (200050, 200010) ),  (SELECT first 1 doc.DOCUMENTDATE " & _
            "      FROM USR$SAN_INVOICE inv " & _
            "      LEFT JOIN GD_DOCUMENT doc ON doc.ID = inv.DOCUMENTKEY " & _
            "      WHERE inv.DOCUMENTKEY IN " & _
            "       ( SELECT  INV.DOCUMENTKEY " & _
            "         FROM USR$HT_RESERVATION RES " & _
            "         LEFT JOIN USR$SAN_INVOICE INV ON (INV.USR$CONTROCCKEY = RES.USR$CONTROCCKEY OR INV.USR$REQUESTKEY = RES.USR$REQUESTKEY ) " & _
            "         WHERE RES.USR$REQUESTKEY = R.USR$REQUESTKEY AND RES.ID = R.ID) " & _
            "      ORDER BY doc.DOCUMENTDATE desc), " & _
            "    IIF((NP.PAYDATE>R.USR$DATEBEGIN) OR (NP.PAYDATE is Null),R.USR$DATEBEGIN,NP.PAYDATE))) CCrur on 1=1 " & _
            "    WHERE " & _
            "      r.USR$STATEKEY <> :CANCELKEY " & _
            "      AND r.USR$DATEBEGIN BETWEEN :DB AND :DE " & _
            "      AND COALESCE(r.USR$RESORT_TAX, 0) = 0 " & _
            strWhere & _
            "      AND ( " & _
            "        ((r.USR$TYPE_PERMIT = :gost and (r.USR$COUNTNIGHT - IIF(COALESCE(r.USR$ISEARLYDEP, 0) = 1, 0.5, 0)) > 1.5 /*and COALESCE(inv.USR$WORESORTTAX, 0) = 0*/)  ) " & _
            "        OR COALESCE(r.USR$TYPE_PERMIT, 0) <> :gost) " & _
            "  ORDER BY r.USR$DATEBEGIN, numb.USR$NAME, p.NICKNAME "
        
          q.ParamByName("CANCELKEY").AsInteger = HT_ReservationStateDict.GetCanceledState.Key
          q.ParamByName("GOST").AsInteger = gdcBaseManager.GetIDByRUIDString("147406748_820098289")
          q.ParamByName("CAT").AsInteger = gdcBaseManager.GetIDByRUIDString("147140069_779589892")'Нерезидент
          q.ParamByName("DB").AsDateTime = Period(0)
          q.ParamByName("DE").AsDateTime = Period(1)
          q.Open
        
          Set rp_Main164720307_1274276790 = BaseQueryList
        End Function
        
  - 
    Properties: 
      Class: "TgdcReport"
      RUID: 164720306_1274276790
      AlwaysOverwrite: False
      DontRemove: False
      IncludeSiblings: False
    Fields: 
      NAME: "Проживающие без оплаты курортного сбора"
      DESCRIPTION: ~
      DISPLAYINMENU: 1
      EVENTFORMULAKEY: "164720704_1274276790 rp_Event164720704_1274276790"
      FOLDERKEY: "148685345_820098289 Исследователь\\3. Бронирование\\17. Отчеты"
      FRQREFRESH: 1
      GLOBALREPORTKEY: ~
      ISLOCALEXECUTE: 1
      ISREBUILD: 1
      MAINFORMULAKEY: "164720307_1274276790 rp_Main164720307_1274276790"
      MODALPREVIEW: 0
      PARAMFORMULAKEY: ~
      PREVIEW: 1
      REPORTGROUPKEY: "147188924_779589892 Документы пользователя\\Заявка"
      SERVERKEY: ~
      TEMPLATEKEY: "164720376_1274276790 HT. Проживающие без курортного сбора"
      EDITIONDATE: 2021-08-02T17:13:41+03:00